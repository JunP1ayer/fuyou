<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰¶é¤Šãƒ—ãƒ­ - ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ æ‰¶é¤Šãƒ—ãƒ­ - ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testBasicFunctions()">åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <div id="basicTest" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ¤– AI Vision Service ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testAIService()">AI Service ãƒ†ã‚¹ãƒˆ</button>
        <div id="aiTest" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>âš™ï¸ æœ€é©åŒ–ã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testOptimizationEngine()">æœ€é©åŒ–ã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆ</button>
        <div id="optimizationTest" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“± PWAæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testPWAFeatures()">PWAæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</button>
        <div id="pwaTest" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testDataProcessing()">ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ†ã‚¹ãƒˆ</button>
        <div id="dataTest" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ” ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°</h2>
        <button onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
        <div id="consoleLog" class="log"></div>
    </div>

    <script src="ai-vision-service.js"></script>
    <script src="fuyou-optimization-engine.js"></script>
    
    <script>
        // ãƒ­ã‚°è¡¨ç¤ºæ©Ÿèƒ½
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn
        };

        function addToLog(type, message) {
            const logDiv = document.getElementById('consoleLog');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div style="color: ${type === 'error' ? 'red' : type === 'warn' ? 'orange' : 'black'}">[${timestamp}] ${type.toUpperCase()}: ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        console.log = function(...args) {
            originalConsole.log(...args);
            addToLog('log', args.join(' '));
        };

        console.error = function(...args) {
            originalConsole.error(...args);
            addToLog('error', args.join(' '));
        };

        console.warn = function(...args) {
            originalConsole.warn(...args);
            addToLog('warn', args.join(' '));
        };

        function clearLog() {
            document.getElementById('consoleLog').innerHTML = '';
        }

        // ãƒ†ã‚¹ãƒˆé–¢æ•°
        function testBasicFunctions() {
            const resultDiv = document.getElementById('basicTest');
            resultDiv.innerHTML = 'ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';
            
            try {
                // LocalStorage ãƒ†ã‚¹ãƒˆ
                localStorage.setItem('test', 'value');
                const testValue = localStorage.getItem('test');
                
                if (testValue !== 'value') {
                    throw new Error('LocalStorage ãƒ†ã‚¹ãƒˆå¤±æ•—');
                }
                
                // Dateå‡¦ç†ãƒ†ã‚¹ãƒˆ
                const today = new Date();
                const yearMonth = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
                
                // åŸºæœ¬çš„ãªè¨ˆç®—ãƒ†ã‚¹ãƒˆ
                const hours = 8;
                const wage = 1000;
                const earnings = hours * wage;
                
                if (earnings !== 8000) {
                    throw new Error('è¨ˆç®—ãƒ†ã‚¹ãƒˆå¤±æ•—');
                }
                
                resultDiv.className = 'test-result success';
                resultDiv.innerHTML = `
                    âœ… åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆæˆåŠŸ<br>
                    â€¢ LocalStorage: OK<br>
                    â€¢ Dateå‡¦ç†: ${yearMonth}<br>
                    â€¢ è¨ˆç®—å‡¦ç†: ${earnings}å††<br>
                `;
                
                console.log('åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ: æˆåŠŸ');
                
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `âŒ åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`;
                console.error('åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—:', error);
            }
        }

        async function testAIService() {
            const resultDiv = document.getElementById('aiTest');
            resultDiv.innerHTML = 'AI Service ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';
            
            try {
                // AI Vision Service åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
                if (typeof AIVisionService === 'undefined') {
                    throw new Error('AIVisionService ã‚¯ãƒ©ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                const aiService = new AIVisionService();
                console.log('AI Service åˆæœŸåŒ–æˆåŠŸ');
                
                // ãƒ¢ãƒƒã‚¯ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
                const mockFile = new File(['test'], 'test-shift.jpg', { type: 'image/jpeg' });
                
                // ãƒ¢ãƒƒã‚¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
                const result = await aiService.getMockResponse(mockFile);
                
                if (!result.success) {
                    throw new Error('ãƒ¢ãƒƒã‚¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå¤±æ•—');
                }
                
                if (!result.shifts || result.shifts.length === 0) {
                    throw new Error('ã‚·ãƒ•ãƒˆãƒ‡ãƒ¼ã‚¿ãŒç”Ÿæˆã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ');
                }
                
                resultDiv.className = 'test-result success';
                resultDiv.innerHTML = `
                    âœ… AI Service ãƒ†ã‚¹ãƒˆæˆåŠŸ<br>
                    â€¢ ã‚¯ãƒ©ã‚¹åˆæœŸåŒ–: OK<br>
                    â€¢ ãƒ¢ãƒƒã‚¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹: OK<br>
                    â€¢ ç”Ÿæˆã•ã‚ŒãŸã‚·ãƒ•ãƒˆæ•°: ${result.shifts.length}ä»¶<br>
                    â€¢ ä¿¡é ¼åº¦: ${Math.round(result.confidence * 100)}%<br>
                `;
                
                console.log('AI Service ãƒ†ã‚¹ãƒˆæˆåŠŸ:', result);
                
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `âŒ AI Service ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`;
                console.error('AI Service ãƒ†ã‚¹ãƒˆå¤±æ•—:', error);
            }
        }

        function testOptimizationEngine() {
            const resultDiv = document.getElementById('optimizationTest');
            resultDiv.innerHTML = 'æœ€é©åŒ–ã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';
            
            try {
                // æœ€é©åŒ–ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
                if (typeof FuyouOptimizationEngine === 'undefined') {
                    throw new Error('FuyouOptimizationEngine ã‚¯ãƒ©ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                const engine = new FuyouOptimizationEngine();
                console.log('æœ€é©åŒ–ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–æˆåŠŸ');
                
                // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
                const currentIncome = 800000; // 80ä¸‡å††
                const testShifts = [
                    {
                        id: 1,
                        date: '2025-07-15',
                        workplaceId: 1,
                        startTime: '10:00',
                        endTime: '18:00',
                        hours: 8,
                        earnings: 8000
                    }
                ];
                const testWorkplaces = [
                    {
                        id: 1,
                        name: 'ãƒ†ã‚¹ãƒˆåº—èˆ—',
                        hourlyWage: 1000
                    }
                ];
                
                // ãƒªã‚¹ã‚¯åˆ†æãƒ†ã‚¹ãƒˆ
                const analysis = engine.analyzeRisk(currentIncome, testShifts, testWorkplaces);
                
                if (!analysis.current || !analysis.prediction) {
                    throw new Error('ãƒªã‚¹ã‚¯åˆ†æçµæœãŒä¸æ­£ã§ã™');
                }
                
                resultDiv.className = 'test-result success';
                resultDiv.innerHTML = `
                    âœ… æœ€é©åŒ–ã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆæˆåŠŸ<br>
                    â€¢ ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–: OK<br>
                    â€¢ ãƒªã‚¹ã‚¯åˆ†æ: OK<br>
                    â€¢ ç¾åœ¨ã®ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«: ${analysis.current.riskLevel}<br>
                    â€¢ æ‰¶é¤Šæ®‹ã‚Šäºˆç®—: Â¥${analysis.current.dependentRemaining.toLocaleString()}<br>
                    â€¢ ææ¡ˆæ•°: ${analysis.optimization.length}ä»¶<br>
                `;
                
                console.log('æœ€é©åŒ–ã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆæˆåŠŸ:', analysis);
                
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `âŒ æœ€é©åŒ–ã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`;
                console.error('æœ€é©åŒ–ã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆå¤±æ•—:', error);
            }
        }

        function testPWAFeatures() {
            const resultDiv = document.getElementById('pwaTest');
            resultDiv.innerHTML = 'PWAæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';
            
            try {
                const features = {
                    serviceWorker: 'serviceWorker' in navigator,
                    notification: 'Notification' in window,
                    vibrate: 'vibrate' in navigator,
                    fullscreen: 'requestFullscreen' in document.documentElement,
                    orientation: 'orientation' in screen,
                    localStorage: typeof Storage !== 'undefined'
                };
                
                const supportedFeatures = Object.entries(features).filter(([key, value]) => value).length;
                const totalFeatures = Object.keys(features).length;
                
                resultDiv.className = 'test-result success';
                resultDiv.innerHTML = `
                    âœ… PWAæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå®Œäº†<br>
                    â€¢ ã‚µãƒãƒ¼ãƒˆç‡: ${supportedFeatures}/${totalFeatures} (${Math.round(supportedFeatures/totalFeatures*100)}%)<br>
                    â€¢ Service Worker: ${features.serviceWorker ? 'âœ…' : 'âŒ'}<br>
                    â€¢ é€šçŸ¥æ©Ÿèƒ½: ${features.notification ? 'âœ…' : 'âŒ'}<br>
                    â€¢ æŒ¯å‹•æ©Ÿèƒ½: ${features.vibrate ? 'âœ…' : 'âŒ'}<br>
                    â€¢ ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³: ${features.fullscreen ? 'âœ…' : 'âŒ'}<br>
                    â€¢ ç”»é¢å‘ã: ${features.orientation ? 'âœ…' : 'âŒ'}<br>
                    â€¢ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: ${features.localStorage ? 'âœ…' : 'âŒ'}<br>
                `;
                
                console.log('PWAæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆæˆåŠŸ:', features);
                
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `âŒ PWAæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`;
                console.error('PWAæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—:', error);
            }
        }

        function testDataProcessing() {
            const resultDiv = document.getElementById('dataTest');
            resultDiv.innerHTML = 'ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';
            
            try {
                // æ—¥ä»˜å‡¦ç†ãƒ†ã‚¹ãƒˆ
                const testDate = new Date('2025-07-19');
                const formattedDate = testDate.toISOString().split('T')[0];
                
                if (formattedDate !== '2025-07-19') {
                    throw new Error('æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå‡¦ç†å¤±æ•—');
                }
                
                // æ™‚é–“è¨ˆç®—ãƒ†ã‚¹ãƒˆ
                const startTime = '10:00';
                const endTime = '18:00';
                const start = new Date(`2000-01-01T${startTime}`);
                const end = new Date(`2000-01-01T${endTime}`);
                const hours = (end - start) / (1000 * 60 * 60);
                
                if (hours !== 8) {
                    throw new Error('æ™‚é–“è¨ˆç®—å‡¦ç†å¤±æ•—');
                }
                
                // é€šè²¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ†ã‚¹ãƒˆ
                const amount = 123456;
                const formatted = amount.toLocaleString();
                
                // JSONã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ
                const testObject = {
                    shifts: [{ id: 1, amount: 1000 }],
                    total: 1000
                };
                const serialized = JSON.stringify(testObject);
                const deserialized = JSON.parse(serialized);
                
                if (deserialized.total !== 1000) {
                    throw new Error('JSONå‡¦ç†å¤±æ•—');
                }
                
                resultDiv.className = 'test-result success';
                resultDiv.innerHTML = `
                    âœ… ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ†ã‚¹ãƒˆæˆåŠŸ<br>
                    â€¢ æ—¥ä»˜å‡¦ç†: ${formattedDate}<br>
                    â€¢ æ™‚é–“è¨ˆç®—: ${hours}æ™‚é–“<br>
                    â€¢ é€šè²¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: ${formatted}<br>
                    â€¢ JSONå‡¦ç†: OK<br>
                `;
                
                console.log('ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ†ã‚¹ãƒˆæˆåŠŸ');
                
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `âŒ ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`;
                console.error('ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ†ã‚¹ãƒˆå¤±æ•—:', error);
            }
        }

        // è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        window.addEventListener('DOMContentLoaded', () => {
            console.log('ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
            addToLog('log', 'ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
        });
    </script>
</body>
</html>