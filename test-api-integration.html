<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API統合テスト</title>
</head>
<body>
    <h1>API統合テスト</h1>
    <button onclick="testAPIIntegration()">APIキー自動取得をテスト</button>
    <div id="results"></div>

    <!-- 必要なスクリプトを読み込み -->
    <script src="secure-config-loader.js"></script>
    <script src="config.js"></script>
    <script src="ai-vision-service.js"></script>
    <script src="gemini-vision-service.js"></script>

    <script>
        function testAPIIntegration() {
            const results = document.getElementById('results');
            results.innerHTML = '<h2>テスト結果:</h2>';
            
            try {
                // OpenAI Vision Service テスト
                const openaiService = new AIVisionService();
                const openaiAvailable = openaiService.isAvailable();
                results.innerHTML += `<p>OpenAI Service: ${openaiAvailable ? '✅ 利用可能' : '❌ 利用不可'}</p>`;
                
                // Gemini Vision Service テスト
                const geminiService = new GeminiVisionService();
                const geminiAvailable = geminiService.isAvailable();
                results.innerHTML += `<p>Gemini Service: ${geminiAvailable ? '✅ 利用可能' : '❌ 利用不可'}</p>`;
                
                // Secure Config テスト
                if (window.secureConfig) {
                    const openaiKey = window.secureConfig.getSecureKey('openai');
                    const geminiKey = window.secureConfig.getSecureKey('gemini');
                    results.innerHTML += `<p>OpenAI キー取得: ${openaiKey ? '✅ 成功' : '❌ 失敗'}</p>`;
                    results.innerHTML += `<p>Gemini キー取得: ${geminiKey ? '✅ 成功' : '❌ 失敗'}</p>`;
                } else {
                    results.innerHTML += `<p>❌ SecureConfig が利用できません</p>`;
                }
                
                if (openaiAvailable && geminiAvailable) {
                    results.innerHTML += '<h3>🎉 すべてのユーザーでAI機能が自動利用可能です！</h3>';
                }
                
            } catch (error) {
                results.innerHTML += `<p>❌ エラー: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>