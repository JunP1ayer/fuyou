<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>扶養プロ - 機能動作テスト</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .test-btn { background: #4CAF50; color: white; padding: 12px 24px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; min-height: 44px; }
        .test-btn:active { transform: scale(0.95); }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; }
        .touch-test { height: 80px; background: #f0f0f0; border: 2px dashed #ccc; display: flex; align-items: center; justify-content: center; margin: 10px 0; border-radius: 8px; user-select: none; }
        .calendar-day { width: 40px; height: 40px; border: 1px solid #ddd; display: inline-block; margin: 2px; text-align: center; line-height: 40px; cursor: pointer; border-radius: 4px; }
        .calendar-day:hover { background: #f0f8ff; }
    </style>
</head>
<body>
    <h1>📱 扶養プロ機能動作テスト</h1>
    
    <div class="test-section">
        <h2>🔧 基本機能テスト</h2>
        <button class="test-btn" onclick="testBasicFunctions()">基本関数チェック</button>
        <button class="test-btn" onclick="testServiceWorker()">Service Worker確認</button>
        <button class="test-btn" onclick="testLocalStorage()">ローカルストレージ確認</button>
        <div id="basicResults"></div>
    </div>

    <div class="test-section">
        <h2>📱 タッチ反応テスト</h2>
        <button class="test-btn" onclick="testTouchFeedback(this)">タッチフィードバックテスト</button>
        <button class="test-btn" onclick="testVibration()">バイブレーション確認</button>
        <div class="touch-test" id="touchArea" ontouchstart="handleTouchStart(event)" ontouchend="handleTouchEnd(event)">
            ここをタッチして反応確認
        </div>
        <div id="touchResults"></div>
    </div>

    <div class="test-section">
        <h2>📋 スワイプ・ジェスチャーテスト</h2>
        <div class="touch-test" id="swipeArea" ontouchstart="handleSwipeStart(event)" ontouchmove="handleSwipeMove(event)" ontouchend="handleSwipeEnd(event)">
            左右にスワイプしてください
        </div>
        <div id="swipeResults"></div>
    </div>

    <div class="test-section">
        <h2>🗓️ ドラッグ&ドロップテスト</h2>
        <div style="margin: 10px 0;">
            <div class="calendar-day" draggable="true" ondragstart="handleDragStart(event)" data-shift-id="test-shift">1</div>
            <div class="calendar-day" ondragover="handleDragOver(event)" ondrop="handleDrop(event)" data-date="2024-01-02">2</div>
            <div class="calendar-day" ondragover="handleDragOver(event)" ondrop="handleDrop(event)" data-date="2024-01-03">3</div>
        </div>
        <p>「1」を「2」または「3」にドラッグしてください</p>
        <div id="dragResults"></div>
    </div>

    <div class="test-section">
        <h2>🔔 通知・トーストテスト</h2>
        <button class="test-btn" onclick="testToast('success')">成功トースト</button>
        <button class="test-btn" onclick="testToast('error')">エラートースト</button>
        <button class="test-btn" onclick="testToast('info')">情報トースト</button>
        <div id="toastResults"></div>
    </div>

    <div class="test-section">
        <h2>📊 メインアプリ連携テスト</h2>
        <button class="test-btn" onclick="openMainApp()">メインアプリを開く</button>
        <button class="test-btn" onclick="testMainAppFunctions()">メイン関数確認</button>
        <div id="mainAppResults"></div>
    </div>

    <script>
        let touchStartTime = 0;
        let swipeStartX = 0;
        let swipeStartY = 0;

        // 基本機能テスト
        function testBasicFunctions() {
            const results = document.getElementById('basicResults');
            let html = '';
            
            // JavaScript基本チェック
            try {
                const testVar = 'test';
                html += '<div class="result success">✅ JavaScript実行環境: 正常</div>';
            } catch (e) {
                html += '<div class="result error">❌ JavaScript実行環境: エラー</div>';
            }
            
            // DOM操作チェック
            try {
                const testDiv = document.createElement('div');
                html += '<div class="result success">✅ DOM操作: 正常</div>';
            } catch (e) {
                html += '<div class="result error">❌ DOM操作: エラー</div>';
            }
            
            // イベントリスナーチェック
            try {
                const testBtn = document.createElement('button');
                testBtn.addEventListener('click', () => {});
                html += '<div class="result success">✅ イベントリスナー: 正常</div>';
            } catch (e) {
                html += '<div class="result error">❌ イベントリスナー: エラー</div>';
            }
            
            results.innerHTML = html;
        }

        // Service Worker確認
        function testServiceWorker() {
            const results = document.getElementById('basicResults');
            
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    if (registrations.length > 0) {
                        results.innerHTML += '<div class="result success">✅ Service Worker: 登録済み (' + registrations.length + '件)</div>';
                    } else {
                        results.innerHTML += '<div class="result info">ℹ️ Service Worker: 未登録</div>';
                    }
                });
            } else {
                results.innerHTML += '<div class="result error">❌ Service Worker: サポート外</div>';
            }
        }

        // ローカルストレージ確認
        function testLocalStorage() {
            const results = document.getElementById('basicResults');
            
            try {
                localStorage.setItem('test', 'value');
                const value = localStorage.getItem('test');
                localStorage.removeItem('test');
                
                if (value === 'value') {
                    results.innerHTML += '<div class="result success">✅ ローカルストレージ: 正常動作</div>';
                } else {
                    results.innerHTML += '<div class="result error">❌ ローカルストレージ: 読み書きエラー</div>';
                }
            } catch (e) {
                results.innerHTML += '<div class="result error">❌ ローカルストレージ: ' + e.message + '</div>';
            }
        }

        // タッチフィードバック確認
        function testTouchFeedback(button) {
            const results = document.getElementById('touchResults');
            
            // 視覚的フィードバック
            button.style.transform = 'scale(0.95)';
            button.style.transition = 'transform 0.1s ease';
            
            setTimeout(() => {
                button.style.transform = 'scale(1)';
            }, 100);
            
            results.innerHTML = '<div class="result success">✅ 視覚的フィードバック: 実行完了</div>';
        }

        // バイブレーション確認
        function testVibration() {
            const results = document.getElementById('touchResults');
            
            if (navigator.vibrate) {
                navigator.vibrate([100, 50, 100]);
                results.innerHTML += '<div class="result success">✅ バイブレーション: 実行完了</div>';
            } else {
                results.innerHTML += '<div class="result info">ℹ️ バイブレーション: サポート外</div>';
            }
        }

        // タッチ処理
        function handleTouchStart(event) {
            touchStartTime = Date.now();
            event.target.style.backgroundColor = '#e3f2fd';
            
            const results = document.getElementById('touchResults');
            results.innerHTML += '<div class="result info">👆 タッチ開始検出</div>';
        }

        function handleTouchEnd(event) {
            const touchDuration = Date.now() - touchStartTime;
            event.target.style.backgroundColor = '#f0f0f0';
            
            const results = document.getElementById('touchResults');
            
            if (touchDuration > 500) {
                results.innerHTML += '<div class="result success">✅ 長押し検出: ' + touchDuration + 'ms</div>';
                if (navigator.vibrate) navigator.vibrate([10, 50, 10]);
            } else {
                results.innerHTML += '<div class="result info">👆 タップ検出: ' + touchDuration + 'ms</div>';
            }
        }

        // スワイプ処理
        function handleSwipeStart(event) {
            swipeStartX = event.touches[0].clientX;
            swipeStartY = event.touches[0].clientY;
        }

        function handleSwipeMove(event) {
            event.preventDefault();
        }

        function handleSwipeEnd(event) {
            const endX = event.changedTouches[0].clientX;
            const endY = event.changedTouches[0].clientY;
            
            const diffX = swipeStartX - endX;
            const diffY = swipeStartY - endY;
            
            const results = document.getElementById('swipeResults');
            
            if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                if (diffX > 0) {
                    results.innerHTML = '<div class="result success">✅ 左スワイプ検出: ' + Math.round(diffX) + 'px</div>';
                } else {
                    results.innerHTML = '<div class="result success">✅ 右スワイプ検出: ' + Math.round(Math.abs(diffX)) + 'px</div>';
                }
                if (navigator.vibrate) navigator.vibrate(10);
            } else {
                results.innerHTML = '<div class="result info">ℹ️ スワイプ距離不足: ' + Math.round(Math.abs(diffX)) + 'px</div>';
            }
        }

        // ドラッグ&ドロップ処理
        function handleDragStart(event) {
            event.dataTransfer.setData('text/plain', event.target.dataset.shiftId);
            event.target.style.opacity = '0.5';
            
            const results = document.getElementById('dragResults');
            results.innerHTML = '<div class="result info">📝 ドラッグ開始</div>';
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.target.style.backgroundColor = '#e8f5e8';
        }

        function handleDrop(event) {
            event.preventDefault();
            const shiftId = event.dataTransfer.getData('text/plain');
            const newDate = event.target.dataset.date;
            
            event.target.style.backgroundColor = '';
            
            const results = document.getElementById('dragResults');
            results.innerHTML = '<div class="result success">✅ ドロップ成功: ' + shiftId + ' → ' + newDate + '</div>';
            
            if (navigator.vibrate) navigator.vibrate([10, 50, 10]);
            
            // 元の要素をリセット
            document.querySelector('[data-shift-id="test-shift"]').style.opacity = '1';
        }

        // トースト通知テスト
        function testToast(type) {
            const messages = {
                success: '✅ 成功メッセージ',
                error: '❌ エラーメッセージ', 
                info: 'ℹ️ 情報メッセージ'
            };
            
            showTestToast(messages[type], type);
            
            const results = document.getElementById('toastResults');
            results.innerHTML = '<div class="result success">✅ ' + type + 'トースト表示完了</div>';
        }

        function showTestToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3'};
                color: white;
                padding: 12px 24px;
                border-radius: 24px;
                z-index: 10000;
                font-size: 14px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 2000);
        }

        // メインアプリ連携
        function openMainApp() {
            window.open('fuyou-pro-app.html', '_blank');
        }

        function testMainAppFunctions() {
            const results = document.getElementById('mainAppResults');
            
            fetch('fuyou-pro-app.html')
                .then(response => response.text())
                .then(html => {
                    const functions = [
                        'enhanceTouchResponsiveness',
                        'initializeShiftBoardUX',
                        'showToast',
                        'moveShift'
                    ];
                    
                    let allFound = true;
                    let details = '';
                    
                    functions.forEach(func => {
                        const found = html.includes(`function ${func}`);
                        if (!found) allFound = false;
                        details += `<div class="result ${found ? 'success' : 'error'}">${found ? '✅' : '❌'} ${func}</div>`;
                    });
                    
                    results.innerHTML = details;
                    
                    if (allFound) {
                        showTestToast('✅ 全ての関数が実装されています', 'success');
                    } else {
                        showTestToast('⚠️ 一部の関数が見つかりません', 'error');
                    }
                })
                .catch(error => {
                    results.innerHTML = '<div class="result error">❌ メインアプリの確認に失敗: ' + error.message + '</div>';
                });
        }

        // 初期表示
        window.onload = function() {
            testBasicFunctions();
            testServiceWorker();
            testLocalStorage();
        };
    </script>
</body>
</html>