<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>【税理士監修】扶養控除ステータス - 扶養管理プロ</title>
    <!-- Cache busting: 2025-07-22T16:45 -->
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Roboto', 'Noto Sans JP', sans-serif;
        background: linear-gradient(135deg, #e8f5e8 0%, #f3e5f5 100%);
        min-height: 100vh;
        color: #1a1a1a;
        line-height: 1.6;
      }

      /* ヘッダー - Material Design 3 */
      .header {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        padding: 20px 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #e0e0e0;
      }

      .header h1 {
        font-size: 26px;
        color: #1976d2;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .header .badge {
        background: linear-gradient(135deg, #4caf50, #66bb6a);
        color: white;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        margin-left: 8px;
      }

      .nav-buttons {
        display: flex;
        gap: 16px;
      }

      .nav-btn {
        padding: 12px 20px;
        border: none;
        border-radius: 24px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .nav-btn.active {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(231, 76, 60, 0.3);
      }

      .nav-btn:not(.active) {
        background: #ffffff;
        color: #666;
        border: 2px solid #e0e0e0;
      }

      .nav-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      /* メインコンテンツ */
      .main-content {
        max-width: 1100px;
        margin: 24px auto;
        padding: 0 24px;
        display: grid;
        gap: 24px;
      }

      /* プロフェッショナルカード */
      .professional-card {
        background: linear-gradient(135deg, #ffffff 0%, #fafafa 100%);
        border-radius: 20px;
        padding: 32px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
        border: 1px solid rgba(25, 118, 210, 0.1);
        position: relative;
        overflow: hidden;
      }

      .professional-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #1976d2, #42a5f5, #4caf50);
      }

      .status-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 24px;
      }

      .status-title {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 28px;
        font-weight: 700;
        color: #1976d2;
      }

      .certification-badge {
        background: linear-gradient(135deg, #ff6b35, #f7931e);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 700;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
      }

      .status-controls {
        display: flex;
        gap: 12px;
      }

      .control-btn {
        background: #f5f5f5;
        border: none;
        border-radius: 12px;
        padding: 12px;
        cursor: pointer;
        color: #1976d2;
        transition: all 0.3s ease;
        font-size: 18px;
      }

      .control-btn:hover {
        background: #e3f2fd;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(25, 118, 210, 0.2);
      }

      /* バレットチャート式進捗表示 */
      .bullet-chart {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 32px;
        border: 1px solid #e0e0e0;
        position: relative;
      }

      .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }

      .chart-title {
        font-size: 20px;
        font-weight: 600;
        color: #2c3e50;
      }

      .percentage-display {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .percentage-value {
        font-size: 36px;
        font-weight: 800;
        color: #27ae60;
      }

      .percentage-value.warning { color: #f39c12; }
      .percentage-value.danger { color: #e74c3c; }

      .status-icon {
        font-size: 32px;
      }

      /* 拡張プログレスバー */
      .enhanced-progress {
        position: relative;
        height: 16px;
        background: #ecf0f1;
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 16px;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #27ae60, #2ecc71);
        border-radius: 8px;
        transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
      }

      .progress-fill.warning {
        background: linear-gradient(90deg, #f39c12, #f1c40f);
      }

      .progress-fill.danger {
        background: linear-gradient(90deg, #e74c3c, #c0392b);
      }

      /* 閾値インジケーター */
      .threshold-indicator {
        position: absolute;
        top: 0;
        height: 100%;
        width: 2px;
        background: rgba(52, 73, 94, 0.7);
        z-index: 2;
      }

      .threshold-70 { left: 70%; background: #f39c12; }
      .threshold-85 { left: 85%; background: #e74c3c; }

      .progress-labels {
        display: flex;
        justify-content: space-between;
        font-size: 14px;
        color: #7f8c8d;
        margin-top: 8px;
      }

      /* リスク評価セクション */
      .risk-assessment {
        background: linear-gradient(135deg, #fff9c4 0%, #ffecb3 100%);
        border-radius: 16px;
        padding: 24px;
        margin: 24px 0;
        border-left: 6px solid #ff9800;
      }

      .risk-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 20px;
      }

      .risk-title {
        font-size: 22px;
        font-weight: 600;
        color: #e65100;
      }

      .risk-items {
        display: grid;
        gap: 16px;
      }

      .risk-item {
        background: rgba(255, 255, 255, 0.8);
        padding: 20px;
        border-radius: 12px;
        border-left: 4px solid #ff9800;
      }

      .risk-item.high {
        border-left-color: #e74c3c;
        background: rgba(255, 235, 238, 0.8);
      }

      .risk-item.medium {
        border-left-color: #f39c12;
        background: rgba(255, 249, 196, 0.8);
      }

      .risk-item-title {
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 8px;
        font-size: 16px;
      }

      .risk-description {
        color: #34495e;
        margin-bottom: 12px;
        line-height: 1.6;
      }

      .risk-recommendation {
        background: rgba(59, 130, 246, 0.1);
        padding: 12px 16px;
        border-radius: 8px;
        border-left: 3px solid #3b82f6;
      }

      .recommendation-label {
        font-weight: 600;
        color: #1e40af;
        font-size: 13px;
      }

      .recommendation-text {
        color: #1e3a8a;
        font-size: 14px;
      }

      /* メトリクスグリッド */
      .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        margin: 32px 0;
      }

      .metric-card {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        padding: 24px;
        border-radius: 16px;
        text-align: center;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        border: 1px solid #e9ecef;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .metric-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      .metric-value {
        font-size: 28px;
        font-weight: 800;
        margin-bottom: 8px;
        color: #2c3e50;
      }

      .metric-value.success { color: #27ae60; }
      .metric-value.primary { color: #3498db; }
      .metric-value.warning { color: #f39c12; }
      .metric-value.danger { color: #e74c3c; }

      .metric-label {
        font-size: 13px;
        color: #7f8c8d;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
      }

      /* 法的根拠セクション */
      .legal-section {
        background: linear-gradient(135deg, #e8f4fd 0%, #bbdefb 100%);
        border-radius: 16px;
        padding: 24px;
        margin: 24px 0;
        border: 1px solid #90caf9;
      }

      .legal-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 16px;
      }

      .legal-title {
        font-size: 20px;
        font-weight: 600;
        color: #1565c0;
      }

      .legal-content {
        display: grid;
        gap: 12px;
        font-size: 14px;
        color: #1e88e5;
      }

      .legal-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid rgba(21, 101, 192, 0.1);
      }

      .legal-item:last-child {
        border-bottom: none;
      }

      /* 予測アラート */
      .prediction-alert {
        background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
        border: 1px solid #ef5350;
        border-radius: 16px;
        padding: 20px;
        margin: 24px 0;
        position: relative;
      }

      .prediction-alert::before {
        content: '⚠️';
        position: absolute;
        top: -10px;
        left: 20px;
        background: #ffffff;
        padding: 0 8px;
        font-size: 20px;
      }

      .alert-title {
        font-size: 18px;
        font-weight: 700;
        color: #c62828;
        margin-bottom: 8px;
      }

      .alert-content {
        color: #d32f2f;
        line-height: 1.6;
      }

      .alert-action {
        background: rgba(198, 40, 40, 0.1);
        padding: 12px 16px;
        border-radius: 8px;
        margin-top: 12px;
        border-left: 4px solid #c62828;
      }

      .action-label {
        font-weight: 600;
        color: #b71c1c;
        font-size: 13px;
      }

      /* モーダルダイアログ */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .modal {
        background: white;
        border-radius: 20px;
        padding: 32px;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }

      .modal-title {
        font-size: 24px;
        font-weight: 700;
        color: #2c3e50;
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 28px;
        cursor: pointer;
        color: #95a5a6;
        padding: 4px;
        border-radius: 8px;
        transition: all 0.3s ease;
      }

      .modal-close:hover {
        background: #ecf0f1;
        color: #34495e;
      }

      /* 計算詳細テーブル */
      .calculation-table {
        width: 100%;
        border-collapse: collapse;
        margin: 16px 0;
      }

      .calculation-table th,
      .calculation-table td {
        padding: 12px 16px;
        text-align: left;
        border-bottom: 1px solid #e0e0e0;
      }

      .calculation-table th {
        background: #f8f9fa;
        font-weight: 600;
        color: #2c3e50;
      }

      .calculation-table td {
        color: #34495e;
      }

      .calculation-table tr:hover {
        background: #f8f9fa;
      }

      /* レスポンシブ */
      @media (max-width: 768px) {
        .main-content {
          padding: 0 16px;
        }
        
        .professional-card {
          padding: 20px;
        }
        
        .metrics-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 16px;
        }
        
        .status-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 16px;
        }

        .percentage-value {
          font-size: 28px;
        }

        .modal {
          padding: 20px;
          max-width: 95%;
        }
      }
    </style>
  </head>
  <body>
    <!-- ヘッダー -->
    <header class="header">
      <div>
        <h1>
          🏛️ 扶養控除ステータス
          <span class="badge">税理士監修</span>
        </h1>
      </div>
      <nav class="nav-buttons">
        <a href="calendar-main.html" class="nav-btn">📅 カレンダー</a>
        <a href="#" class="nav-btn active">📊 扶養状況</a>
      </nav>
    </header>

    <!-- メインコンテンツ -->
    <main class="main-content">
      <!-- プロフェッショナル扶養ステータスカード -->
      <div class="professional-card">
        <div class="status-header">
          <div class="status-title">
            <span>⚖️</span>
            扶養控除ステータス【2025年度税制対応】
          </div>
          <div class="certification-badge">
            税理士監修済み
          </div>
          <div class="status-controls">
            <button class="control-btn" onclick="openCalculationModal()" title="計算根拠・法的詳細">
              🧮
            </button>
            <button class="control-btn" onclick="openScenarioModal()" title="シナリオ分析">
              🔮
            </button>
          </div>
        </div>

        <!-- バレットチャート式進捗表示 -->
        <div class="bullet-chart">
          <div class="chart-header">
            <div class="chart-title">扶養限度額使用率</div>
            <div class="percentage-display">
              <div class="percentage-value" id="usagePercentage">63.1%</div>
              <div class="status-icon" id="statusIcon">🛡️</div>
            </div>
          </div>
          <div class="enhanced-progress">
            <div class="progress-fill" id="progressBar" style="width: 63.1%"></div>
            <div class="threshold-indicator threshold-70"></div>
            <div class="threshold-indicator threshold-85"></div>
          </div>
          <div class="progress-labels">
            <span>現在: <strong id="currentIncome">¥650,000</strong></span>
            <span>限度額: <strong>¥1,030,000</strong></span>
          </div>
        </div>

        <!-- リスク評価・対策提案 -->
        <div class="risk-assessment">
          <div class="risk-header">
            <span>⚠️</span>
            <div class="risk-title">リスク評価・対策提案</div>
          </div>
          <div class="risk-items">
            <div class="risk-item medium">
              <div class="risk-item-title">年末調整における扶養控除失効リスク</div>
              <div class="risk-description">
                現在のペースで収入が継続した場合、12月時点で限度額を超過する可能性があります。
              </div>
              <div class="risk-recommendation">
                <div class="recommendation-label">税理士推奨対策:</div>
                <div class="recommendation-text">月間収入を98,000円以下に調整することを推奨します</div>
              </div>
            </div>
            <div class="risk-item high">
              <div class="risk-item-title">社会保険扶養認定解除リスク</div>
              <div class="risk-description">
                月収108,334円超過により、健康保険の扶養から外れる可能性があります。
              </div>
              <div class="risk-recommendation">
                <div class="recommendation-label">税理士推奨対策:</div>
                <div class="recommendation-text">直近3か月の平均月収を10.8万円以下に維持してください</div>
              </div>
            </div>
          </div>
        </div>

        <!-- メトリクスグリッド -->
        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-value success" id="remainingCapacity">¥380,000</div>
            <div class="metric-label">残り利用可能額</div>
          </div>
          <div class="metric-card">
            <div class="metric-value primary" id="monthlyIncome">¥54,167</div>
            <div class="metric-label">今月収入</div>
          </div>
          <div class="metric-card">
            <div class="metric-value primary" id="monthlyTarget">¥85,833</div>
            <div class="metric-label">月間目標収入</div>
          </div>
          <div class="metric-card">
            <div class="metric-value warning" id="yearProjection">¥980,000</div>
            <div class="metric-label">年間予測収入</div>
          </div>
        </div>

        <!-- 予測アラート -->
        <div class="prediction-alert" id="predictionAlert" style="display: none;">
          <div class="alert-title">扶養控除失効予測アラート</div>
          <div class="alert-content">
            現在のペースで収入が継続した場合、年間予測収入が限度額を
            <strong id="overageAmount">¥50,000</strong>超過し、扶養控除の適用を受けられなくなる可能性があります。
          </div>
          <div class="alert-action">
            <div class="action-label">税理士推奨対策:</div>
            <div>月間収入を<strong id="recommendedMonthly">¥85,833</strong>以下に調整</div>
          </div>
        </div>

        <!-- 法的根拠・適用制度 -->
        <div class="legal-section">
          <div class="legal-header">
            <span>📚</span>
            <div class="legal-title">法的根拠・適用制度</div>
          </div>
          <div class="legal-content">
            <div class="legal-item">
              <span>適用制度</span>
              <strong>扶養控除（一般）</strong>
            </div>
            <div class="legal-item">
              <span>法的根拠</span>
              <strong>所得税法第2条第1項第34号、同法第84条</strong>
            </div>
            <div class="legal-item">
              <span>限度額根拠</span>
              <strong>所得税法施行令第217条の2</strong>
            </div>
            <div class="legal-item">
              <span>計算基準日</span>
              <strong id="calculationDate">2025年7月22日</strong>
            </div>
            <div class="legal-item">
              <span>税制改正対応</span>
              <strong>2025年度税制改正対応済み</strong>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- 計算根拠ダイアログ -->
    <div class="modal-overlay" id="calculationModal">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">🧮 計算根拠・法的詳細</div>
          <button class="modal-close" onclick="closeCalculationModal()">&times;</button>
        </div>
        <div class="modal-content">
          <h3>収入区分別内訳</h3>
          <table class="calculation-table">
            <thead>
              <tr>
                <th>収入区分</th>
                <th>金額</th>
                <th>割合</th>
                <th>法的根拠</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <strong>給与所得</strong><br>
                  <small>基本給与・賞与等</small>
                </td>
                <td><strong>¥443,000</strong></td>
                <td>68.2%</td>
                <td><small>所得税法第28条第1項</small></td>
              </tr>
              <tr>
                <td>
                  <strong>アルバイト所得</strong><br>
                  <small>年間アルバイト収入</small>
                </td>
                <td><strong>¥153,000</strong></td>
                <td>23.5%</td>
                <td><small>所得税法第28条第1項</small></td>
              </tr>
              <tr>
                <td>
                  <strong>雑所得</strong><br>
                  <small>フリーランス・副業等</small>
                </td>
                <td><strong>¥54,000</strong></td>
                <td>8.3%</td>
                <td><small>所得税法第35条</small></td>
              </tr>
            </tbody>
          </table>

          <h3 style="margin-top: 24px;">税制改正による変更点（2025年度）</h3>
          <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-top: 12px;">
            <ul style="margin-left: 20px; color: #2c3e50;">
              <li>扶養控除の判定基準が一部変更されました</li>
              <li>給与所得控除の改正に対応済みです</li>
              <li>社会保険の扶養認定基準も最新版を適用しています</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- シナリオ分析ダイアログ -->
    <div class="modal-overlay" id="scenarioModal">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">🔮 AI予測シナリオ分析</div>
          <button class="modal-close" onclick="closeScenarioModal()">&times;</button>
        </div>
        <div class="modal-content">
          <p style="color: #666; margin-bottom: 24px; line-height: 1.6;">
            現在の収入パターンに基づく複数シナリオの予測分析
          </p>
          
          <div style="background: #e3f2fd; padding: 20px; border-radius: 12px; border-left: 4px solid #2196f3;">
            <h4 style="color: #1565c0; margin-bottom: 12px;">💡 高度なシナリオ分析機能</h4>
            <p style="color: #1976d2; margin-bottom: 16px;">
              AIを活用した予測分析機能は現在開発中です。近日中にリリース予定です。
            </p>
            <div style="font-size: 14px; color: #1565c0;">
              <strong>実装予定機能:</strong>
              <ul style="margin-left: 20px; margin-top: 8px;">
                <li>月別収入変動シミュレーション</li>
                <li>最適労働時間の提案</li>
                <li>税制変更による影響分析</li>
                <li>社会保険料負担の予測</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // 現在の扶養データ（実際のAPIから取得予定）
      const fuyouData = {
        currentIncome: 650000,
        limit: 1030000,
        monthlyTarget: 85833,
        projectedYear: 980000,
        riskLevel: 'safe'
      };

      // ページ読み込み時の初期化
      document.addEventListener('DOMContentLoaded', function() {
        updateFuyouStatus();
        animateProgressBar();
        
        // 現在日時を表示
        const now = new Date();
        document.getElementById('calculationDate').textContent = 
          now.toLocaleDateString('ja-JP', { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
          });
      });

      // 扶養ステータスの更新
      function updateFuyouStatus() {
        const usageRate = (fuyouData.currentIncome / fuyouData.limit) * 100;
        const remainingAmount = fuyouData.limit - fuyouData.currentIncome;
        const monthlyIncome = Math.floor(fuyouData.currentIncome / 12);
        
        // パーセンテージ表示の更新
        const percentageElement = document.getElementById('usagePercentage');
        const statusIcon = document.getElementById('statusIcon');
        
        percentageElement.textContent = usageRate.toFixed(1) + '%';
        
        // リスクレベルに応じた色とアイコンの変更
        if (usageRate < 70) {
          percentageElement.className = 'percentage-value success';
          statusIcon.textContent = '🛡️';
        } else if (usageRate < 85) {
          percentageElement.className = 'percentage-value warning';
          statusIcon.textContent = '⚠️';
        } else {
          percentageElement.className = 'percentage-value danger';
          statusIcon.textContent = '🚨';
        }

        // その他の値を更新
        document.getElementById('currentIncome').textContent = 
          '¥' + fuyouData.currentIncome.toLocaleString();
        document.getElementById('remainingCapacity').textContent = 
          '¥' + remainingAmount.toLocaleString();
        document.getElementById('monthlyIncome').textContent = 
          '¥' + monthlyIncome.toLocaleString();
        document.getElementById('monthlyTarget').textContent = 
          '¥' + fuyouData.monthlyTarget.toLocaleString();
        document.getElementById('yearProjection').textContent = 
          '¥' + fuyouData.projectedYear.toLocaleString();

        // 予測アラートの表示判定
        if (fuyouData.projectedYear > fuyouData.limit) {
          const overage = fuyouData.projectedYear - fuyouData.limit;
          document.getElementById('predictionAlert').style.display = 'block';
          document.getElementById('overageAmount').textContent = 
            '¥' + overage.toLocaleString();
          document.getElementById('recommendedMonthly').textContent = 
            '¥' + Math.floor(fuyouData.limit / 12).toLocaleString();
        }
      }

      // プログレスバーのアニメーション
      function animateProgressBar() {
        setTimeout(() => {
          const usageRate = (fuyouData.currentIncome / fuyouData.limit) * 100;
          const progressBar = document.getElementById('progressBar');
          progressBar.style.width = usageRate + '%';
          
          // リスクレベルに応じた色の変更
          if (usageRate >= 85) {
            progressBar.className = 'progress-fill danger';
          } else if (usageRate >= 70) {
            progressBar.className = 'progress-fill warning';
          } else {
            progressBar.className = 'progress-fill';
          }
        }, 500);
      }

      // 計算根拠ダイアログを開く
      function openCalculationModal() {
        document.getElementById('calculationModal').style.display = 'flex';
      }

      // 計算根拠ダイアログを閉じる
      function closeCalculationModal() {
        document.getElementById('calculationModal').style.display = 'none';
      }

      // シナリオ分析ダイアログを開く
      function openScenarioModal() {
        document.getElementById('scenarioModal').style.display = 'flex';
      }

      // シナリオ分析ダイアログを閉じる
      function closeScenarioModal() {
        document.getElementById('scenarioModal').style.display = 'none';
      }

      // モーダルの外側をクリックして閉じる
      document.getElementById('calculationModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeCalculationModal();
        }
      });

      document.getElementById('scenarioModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeScenarioModal();
        }
      });

      // カードホバー効果の追加
      document.querySelectorAll('.metric-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-6px) scale(1.02)';
        });
        
        card.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0) scale(1)';
        });
      });

      console.log('🏛️ 税理士監修扶養管理システム初期化完了');
      console.log('📊 現在の使用率:', ((fuyouData.currentIncome / fuyouData.limit) * 100).toFixed(1) + '%');
    </script>
    
    <!-- Force deploy: Tue Jul 22 16:45:00 JST 2025 -->
  </body>
</html>