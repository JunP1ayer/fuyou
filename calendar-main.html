<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ã‚·ãƒ•ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ - æ‰¶é¤Šç®¡ç†</title>
    <!-- Cache busting: 2025-01-21T23:35 -->
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Roboto', 'Noto Sans JP', sans-serif;
        background: #f8f9fa;
        min-height: 100vh;
        color: #333;
      }

      /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
      .header {
        background: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 16px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .header h1 {
        font-size: 24px;
        color: #2c3e50;
        font-weight: 600;
      }

      .nav-buttons {
        display: flex;
        gap: 12px;
      }

      .nav-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .nav-btn.active {
        background: #3498db;
        color: white;
      }

      .nav-btn:not(.active) {
        background: #ecf0f1;
        color: #7f8c8d;
      }

      .nav-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }

      /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ - åœ§ç¸® */
      .main-content {
        max-width: 800px;
        margin: 8px auto;
        padding: 0 16px;
      }

      /* æœˆé–“ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ - åœ§ç¸® */
      .month-nav {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 4px;
        padding: 4px 0;
        position: relative;
        touch-action: pan-y;
      }

      .month-title {
        font-size: 18px;
        font-weight: 600;
        color: #2c3e50;
        text-align: center;
        min-width: 100px;
        margin: 0;
      }

      .month-btn {
        background: transparent;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: #3498db;
        transition: all 0.2s;
        position: absolute;
      }

      .month-btn:first-child {
        left: 10px;
      }

      .month-btn:last-child {
        right: 10px;
      }

      .month-btn:hover {
        background: rgba(52, 152, 219, 0.1);
        transform: scale(1.1);
      }

      .month-btn:active {
        background: rgba(52, 152, 219, 0.2);
        transform: scale(0.95);
      }

      /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚°ãƒªãƒƒãƒ‰ - å®Œå…¨è¡¨ç¤º */
      .calendar {
        background: white;
        border-radius: 12px;
        padding: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }

      .calendar-header {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        margin-bottom: 8px;
      }

      .day-header {
        text-align: center;
        padding: 12px 0;
        font-weight: 600;
        font-size: 14px;
        color: #7f8c8d;
        background: #f8f9fa;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .day-header.saturday {
        color: #3498db;
      }

      .day-header.sunday {
        color: #e74c3c;
      }

      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 2px;
        width: 100%;
      }

      .calendar-day {
        aspect-ratio: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        padding: 10px 0;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        min-height: 100px;
        position: relative;
        box-sizing: border-box;
      }

      .calendar-day:hover {
        background: #ecf0f1;
      }

      .calendar-day.other-month {
        color: #bdc3c7;
        opacity: 0.5;
      }
      
      .calendar-day.other-month .day-number {
        color: #bdc3c7;
      }

      .calendar-day.today {
        background: #e3f2fd;
        color: #1976d2;
        border: 1px solid #bbdefb;
      }

      .calendar-day.has-shift {
        background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
        border: 2px solid #4caf50;
      }

      .day-number {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 6px;
        width: 100%;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .shift-indicator {
        background: #4caf50;
        color: white;
        padding: 2px 6px;
        border-radius: 10px;
        font-size: 10px;
        margin-bottom: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
      }

      /* æœˆåã‚µãƒãƒªãƒ¼ */
      .monthly-summary {
        background: white;
        border-radius: 12px;
        padding: 16px 20px;
        margin-top: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .summary-item {
        text-align: center;
      }

      .summary-label {
        font-size: 12px;
        color: #7f8c8d;
        margin-bottom: 4px;
      }

      .summary-value {
        font-size: 18px;
        font-weight: 600;
        color: #2c3e50;
      }

      .summary-value.earnings {
        color: #27ae60;
      }



      .floating-workplace {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 56px;
        height: 56px;
        background: #3498db;
        border: none;
        border-radius: 50%;
        color: white;
        font-size: 24px;
        cursor: pointer;
        box-shadow: 0 4px 16px rgba(52, 152, 219, 0.4);
        transition: all 0.3s;
      }

      .floating-workplace:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(52, 152, 219, 0.6);
      }

      /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */
      .popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        z-index: 1001;
        display: none;
        max-height: 90vh;
        overflow-y: auto;
      }

      .shift-popup {
        min-width: 320px;
      }

      .workplace-popup {
        min-width: 480px;
      }

      .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        display: none;
      }

      .popup-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .popup-title {
        font-size: 18px;
        font-weight: bold;
        color: #2c3e50;
      }

      .close-btn {
        background: none;
        border: none;
        font-size: 24px;
        color: #7f8c8d;
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
      }

      .close-btn:hover {
        background: #ecf0f1;
      }

      .form-group {
        margin-bottom: 16px;
      }

      .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #2c3e50;
        font-size: 14px;
      }

      .form-input,
      .form-select {
        width: 100%;
        padding: 12px;
        border: 2px solid #ecf0f1;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.2s;
      }

      .form-input:focus,
      .form-select:focus {
        outline: none;
        border-color: #3498db;
      }

      .time-inputs {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }

      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s;
      }

      .btn-primary {
        background: #3498db;
        color: white;
      }

      .btn-primary:hover {
        background: #2980b9;
      }

      .btn-secondary {
        background: #ecf0f1;
        color: #7f8c8d;
      }

      .btn-secondary:hover {
        background: #d5dbdb;
      }

      .btn-danger {
        background: #e74c3c;
        color: white;
      }

      .btn-danger:hover {
        background: #c0392b;
      }

      .workplace-list {
        max-height: 200px;
        overflow-y: auto;
        margin-bottom: 16px;
      }

      .workplace-item {
        padding: 12px;
        border: 1px solid #ecf0f1;
        border-radius: 8px;
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .workplace-info h4 {
        color: #2c3e50;
        margin-bottom: 4px;
      }

      .workplace-info p {
        color: #7f8c8d;
        font-size: 12px;
      }

      .workplace-actions {
        display: flex;
        gap: 8px;
      }

      .btn-small {
        padding: 6px 12px;
        font-size: 12px;
      }

      .checkbox-group {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
        margin-bottom: 12px;
      }

      .checkbox-item {
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .form-row {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 12px;
        align-items: end;
      }

      /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
      @media (max-width: 768px) {
        body {
          min-height: 100vh;
        }
        
        .main-content {
          padding: 0 4px;
          min-height: calc(100vh - 70px);
          display: flex;
          flex-direction: column;
        }
        
        .header {
          flex-shrink: 0;
          padding: 10px 12px;
        }
        
        .month-nav {
          flex-shrink: 0;
          margin-bottom: 4px;
          padding: 4px 0;
        }
        
        .month-title {
          font-size: 16px;
        }
        
        .month-btn {
          width: 36px;
          height: 36px;
          font-size: 18px;
        }
        
        .month-btn:first-child {
          left: 8px;
        }

        .month-btn:last-child {
          right: 8px;
        }
        
        .calendar {
          display: flex;
          flex-direction: column;
          margin: 4px 0;
          padding: 8px;
          box-shadow: none;
        }
        
        .calendar-header {
          flex-shrink: 0;
          margin-bottom: 8px;
        }
        
        .calendar-grid {
          gap: 1px;
          display: grid;
          grid-template-columns: repeat(7, 1fr);
          grid-auto-rows: 1fr;
        }
        
        .calendar-day {
          aspect-ratio: 1;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 2px;
          font-size: 11px;
          box-sizing: border-box;
          overflow: hidden;
          position: relative;
        }
        
        .calendar-day::before {
          content: '';
          position: absolute;
          top: 50%;
          left: 50%;
          width: 80%;
          height: 80%;
          transform: translate(-50%, -50%);
          border-radius: 8px;
          background: transparent;
          z-index: 1;
        }
        
        .calendar-day:active::before {
          background: rgba(52, 152, 219, 0.1);
        }
        
        .day-header {
          padding: 6px 0;
          font-size: 11px;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        
        .day-number {
          font-size: 12px;
          font-weight: 600;
          line-height: 1;
          width: 100%;
          height: auto;
          text-align: center;
          display: flex;
          align-items: center;
          justify-content: center;
          margin: 0;
          padding: 0;
        }
        
        .calendar-day.today {
          background: #f0f8ff;
          color: #1976d2;
          border: 1px solid #e3f2fd;
        }
        
        .shift-indicator {
          font-size: 7px;
          padding: 1px 2px;
          margin-top: 1px;
          line-height: 1;
        }
        

        .popup {
          width: 90%;
          min-width: 0;
          max-width: 400px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .workplace-popup {
          min-width: 0;
        }

        .time-inputs {
          grid-template-columns: 1fr;
        }

        .checkbox-group {
          grid-template-columns: repeat(3, 1fr);
        }
      }

      /* éå¸¸ã«å°ã•ã„ç”»é¢å¯¾å¿œ */
      @media (max-width: 480px) {
        .main-content {
          height: calc(100vh - 70px);
        }
        
        .header {
          padding: 8px 12px;
        }
        
        .header h1 {
          font-size: 18px;
        }
        
        .nav-btn {
          padding: 6px 12px;
          font-size: 12px;
        }
        
        .calendar {
          padding: 8px;
        }
        
        .day-header {
          padding: 4px 0;
          font-size: 10px;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        
        .calendar-day {
          aspect-ratio: 1;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: flex-start;
          padding: 3px 0;
          font-size: 10px;
          box-sizing: border-box;
          overflow: hidden;
        }
        
        .day-number {
          font-size: 11px;
          width: 100%;
          height: auto;
          text-align: center;
          display: flex;
          align-items: center;
          justify-content: center;
          margin: 0;
          padding: 0;
          line-height: 1;
        }
        
        .calendar-day.today {
          background: #f8fcff;
          color: #1976d2;
          border: 1px solid #e8f4f8;
        }
        
        .shift-indicator {
          font-size: 6px;
          padding: 0px 1px;
        }
        
      }

      /* Shiftboardé¢¨ã‚¹ã‚¿ã‚¤ãƒ« */
      .shiftboard-style {
        border-radius: 12px;
        overflow: hidden;
      }

      .shiftboard-header {
        background: #f8f9fa;
        padding: 16px 20px;
        display: flex;
        align-items: center;
        border-bottom: 1px solid #e9ecef;
        position: relative;
      }

      .popup-title-centered {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        font-size: 18px;
        font-weight: 600;
        color: #2c3e50;
      }

      .close-btn-green {
        background: #28a745;
        border: none;
        color: white;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        font-weight: bold;
        transition: all 0.2s;
        margin-left: auto;
      }

      .close-btn-green:hover {
        background: #218838;
      }

      .shiftboard-form-group {
        border-bottom: 1px solid #f0f0f0;
      }

      .shiftboard-form-group:last-of-type {
        border-bottom: none;
      }

      .form-row {
        display: flex;
        align-items: center;
        padding: 16px 20px;
        min-height: 60px;
      }

      .form-label-left {
        font-size: 16px;
        color: #666;
        font-weight: 500;
        min-width: 80px;
        margin-right: 16px;
      }

      .form-value-right {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 8px;
      }

      .shiftboard-input, .shiftboard-select, .shiftboard-date, .shiftboard-time {
        border: none;
        outline: none;
        text-align: right;
        font-size: 16px;
        background: transparent;
        color: #333;
        padding: 8px 0;
      }

      .shiftboard-input::placeholder {
        color: #aaa;
        text-align: right;
      }

      .shiftboard-select {
        appearance: none;
        background: transparent;
        cursor: pointer;
      }

      .arrow-right {
        color: #ccc;
        font-size: 16px;
      }

      .shiftboard-date, .shiftboard-time {
        font-size: 14px;
        color: #666;
      }

      .complete-btn-green {
        width: calc(100% - 40px);
        background: #28a745;
        color: white;
        border: none;
        padding: 16px;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        margin: 20px 20px;
        transition: all 0.2s;
      }

      .complete-btn-green:hover {
        background: #218838;
      }

      .complete-btn-green:disabled {
        background: #6c757d;
        cursor: not-allowed;
      }

      .predicted-salary {
        color: #28a745;
        font-weight: 600;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="header">
      <h1>ã‚·ãƒ•ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h1>
      <nav class="nav-buttons">
        <a href="#" class="nav-btn active">ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</a>
        <a href="salary-status.html" class="nav-btn">ğŸ’° çµ¦æ–™</a>
      </nav>
    </header>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="main-content">
      <!-- æœˆé–“ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
      <div class="month-nav">
        <button class="month-btn" onclick="changeMonth(-1)">â€¹</button>
        <h2 class="month-title" id="currentMonth">2025å¹´1æœˆ</h2>
        <button class="month-btn" onclick="changeMonth(1)">â€º</button>
      </div>

      <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
      <div class="calendar">
        <div class="calendar-header">
          <div class="day-header sunday">æ—¥</div>
          <div class="day-header">æœˆ</div>
          <div class="day-header">ç«</div>
          <div class="day-header">æ°´</div>
          <div class="day-header">æœ¨</div>
          <div class="day-header">é‡‘</div>
          <div class="day-header saturday">åœŸ</div>
        </div>
        <div class="calendar-grid" id="calendarGrid">
          <!-- JavaScript ã§ç”Ÿæˆ -->
        </div>
      </div>

    </main>

    <!-- ãƒã‚¤ãƒˆå…ˆç®¡ç†ãƒœã‚¿ãƒ³ -->
    <button class="floating-workplace" onclick="openWorkplaceManager()" title="ãƒã‚¤ãƒˆå…ˆç®¡ç†">+</button>

    <!-- ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div class="popup-overlay" id="popupOverlay" onclick="closePopups()"></div>

    <!-- è·å ´ç®¡ç†ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    <div class="popup workplace-popup" id="workplacePopup">
      <div class="popup-header">
        <div class="popup-title">ğŸ¢ ãƒã‚¤ãƒˆå…ˆç®¡ç†</div>
        <button class="close-btn" onclick="closePopups()">&times;</button>
      </div>

      <div class="workplace-list" id="workplaceList">
        <div style="text-align: center; padding: 20px; color: #666">
          ã¾ã ãƒã‚¤ãƒˆå…ˆãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“
        </div>
      </div>

      <button class="btn btn-primary" onclick="openWorkplaceForm()" style="width: 100%;">
        â• æ–°ã—ã„ãƒã‚¤ãƒˆå…ˆã‚’è¿½åŠ 
      </button>
    </div>

    <!-- è·å ´ç™»éŒ²ãƒ»ç·¨é›†ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    <div class="popup workplace-popup" id="workplaceFormPopup">
      <div class="popup-header">
        <div class="popup-title">
          ğŸ¢ <span id="workplaceFormTitle">æ–°ã—ã„ãƒã‚¤ãƒˆå…ˆã‚’è¿½åŠ </span>
        </div>
        <button class="close-btn" onclick="closePopups()">&times;</button>
      </div>

      <div class="form-group">
        <label class="form-label">è·å ´å *</label>
        <input
          type="text"
          class="form-input"
          id="workplaceName"
          placeholder="ä¾‹: ãƒ•ã‚¡ãƒŸãƒªãƒ¼ãƒãƒ¼ãƒˆæ–°å®¿åº—"
        />
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">åŸºæœ¬æ™‚çµ¦ (å††) *</label>
          <input
            type="number"
            class="form-input"
            id="baseHourlyWage"
            placeholder="1000"
          />
        </div>
        <div class="form-group">
          <label class="form-label">äº¤é€šè²» (å††)</label>
          <input
            type="number"
            class="form-input"
            id="transportationFee"
            placeholder="200"
            value="0"
          />
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">æ·±å¤œãƒ»æ™‚é–“å¸¯åˆ¥å‰²å¢—</label>
        <div class="form-row">
          <select class="form-select" id="nightShiftType" onchange="updateNightShiftFields()">
            <option value="none">å‰²å¢—ãªã—</option>
            <option value="legal">æ³•å®šæ·±å¤œå‰²å¢— (22:00-5:00, 25%)</option>
            <option value="flexible">æŸ”è»Ÿãªæ™‚é–“å¸¯è¨­å®š</option>
          </select>
          <button
            type="button"
            class="form-input"
            id="configureFlexible"
            onclick="openFlexibleRateConfig()"
            style="display: none; background: #f5f5f5; border: 2px dashed #ccc; cursor: pointer;"
          >
            æ™‚é–“å¸¯ã‚’è¨­å®š
          </button>
        </div>
        <div id="flexibleRatesDisplay" style="margin-top: 8px; display: none;">
          <div style="font-size: 12px; color: #666;">è¨­å®šã•ã‚ŒãŸæ™‚é–“å¸¯å‰²å¢—ï¼š</div>
          <div id="flexibleRatesList" style="font-size: 11px; color: #888; margin-top: 4px;"></div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">æ›œæ—¥åˆ¥æ™‚çµ¦è¨­å®š</label>
        <div class="checkbox-group">
          <div class="checkbox-item">
            <input type="checkbox" id="dayPremium_0" onchange="updateDayPremiumFields()" />
            <label for="dayPremium_0">æ—¥</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="dayPremium_1" onchange="updateDayPremiumFields()" />
            <label for="dayPremium_1">æœˆ</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="dayPremium_2" onchange="updateDayPremiumFields()" />
            <label for="dayPremium_2">ç«</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="dayPremium_3" onchange="updateDayPremiumFields()" />
            <label for="dayPremium_3">æ°´</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="dayPremium_4" onchange="updateDayPremiumFields()" />
            <label for="dayPremium_4">æœ¨</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="dayPremium_5" onchange="updateDayPremiumFields()" />
            <label for="dayPremium_5">é‡‘</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="dayPremium_6" onchange="updateDayPremiumFields()" />
            <label for="dayPremium_6">åœŸ</label>
          </div>
        </div>
        <div class="form-row">
          <input
            type="number"
            class="form-input"
            id="dayPremiumRate"
            placeholder="1100 (å††)"
            disabled
          />
          <select class="form-select" id="dayPremiumType" disabled onchange="updateDayPremiumFields()">
            <option value="fixed">å›ºå®šé¡</option>
            <option value="rate">å‰²å¢—ç‡ (%)</option>
          </select>
        </div>
      </div>

      <div style="display: flex; gap: 12px;">
        <button class="btn btn-secondary" onclick="closeWorkplaceForm()" style="flex: 1;">
          ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        </button>
        <button class="btn btn-primary" onclick="saveWorkplace()" style="flex: 2;">
          ä¿å­˜
        </button>
      </div>
    </div>

    <!-- ã‚·ãƒ•ãƒˆç™»éŒ²ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ï¼ˆã‚·ãƒ•ãƒˆãƒœãƒ¼ãƒ‰é¢¨ï¼‰ -->
    <div class="popup shift-popup shiftboard-style" id="shiftPopup">
      <div class="popup-header shiftboard-header">
        <button class="close-btn-green" onclick="closeShiftPopup()">âœ•</button>
        <div class="popup-title-centered">
          <span id="popupTitle">ã‚·ãƒ•ãƒˆã®è¿½åŠ </span>
        </div>
      </div>
      <input type="hidden" id="shiftDate" />

      <!-- å‹¤å‹™å…ˆé¸æŠ -->
      <div class="shiftboard-form-group">
        <div class="form-row">
          <label class="form-label-left">å‹¤å‹™å…ˆ</label>
          <div class="form-value-right">
            <select class="shiftboard-select" id="workplaceSelect" onchange="updatePredictedEarnings()">
              <option value="">è·å ´ã‚’é¸æŠ</option>
            </select>
            <span class="arrow-right">ã€‰</span>
          </div>
        </div>
      </div>

      <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
      <div class="shiftboard-form-group">
        <div class="form-row">
          <label class="form-label-left">ã‚¿ã‚¤ãƒˆãƒ«</label>
          <div class="form-value-right">
            <input type="text" class="shiftboard-input" id="shiftTitle" placeholder="ï¼ˆä»»æ„ï¼‰ã‚¿ã‚¤ãƒˆãƒ«æœªè¨­å®š">
          </div>
        </div>
      </div>

      <!-- é–‹å§‹æ™‚é–“ -->
      <div class="shiftboard-form-group">
        <div class="form-row">
          <label class="form-label-left">é–‹å§‹</label>
          <div class="form-value-right">
            <input type="date" class="shiftboard-date" id="startDate" onchange="updatePredictedEarnings()">
            <input type="time" class="shiftboard-time" id="startTime" value="22:00" onchange="updatePredictedEarnings()">
          </div>
        </div>
      </div>

      <!-- çµ‚äº†æ™‚é–“ -->
      <div class="shiftboard-form-group">
        <div class="form-row">
          <label class="form-label-left">çµ‚äº†</label>
          <div class="form-value-right">
            <input type="date" class="shiftboard-date" id="endDate" onchange="updatePredictedEarnings()">
            <input type="time" class="shiftboard-time" id="endTime" value="23:00" onchange="updatePredictedEarnings()">
          </div>
        </div>
      </div>

      <!-- ä¼‘æ†© -->
      <div class="shiftboard-form-group">
        <div class="form-row">
          <label class="form-label-left">ä¼‘æ†©</label>
          <div class="form-value-right">
            <input type="number" class="shiftboard-break" id="breakTime" value="0" min="0" max="480" step="15" onchange="updatePredictedEarnings()">
            <span class="break-unit">åˆ†</span>
          </div>
        </div>
      </div>

      <!-- çµ¦æ–™ -->
      <div class="shiftboard-form-group salary-preview">
        <div class="form-row">
          <label class="form-label-left">çµ¦æ–™</label>
          <div class="form-value-right">
            <span class="salary-calculation" id="salaryPreview">å®Œäº†ã™ã‚‹ã¨è¨ˆç®—ã•ã‚Œã¾ã™</span>
            <button class="salary-detail-btn" onclick="showSalaryDetail()">å¤©å¼•ãƒ»æ‰‹å½“ã®å…¥åŠ›</button>
          </div>
        </div>
      </div>

      <!-- çµ¦æ–™ã®å€‹åˆ¥è¨­å®š -->
      <div class="shiftboard-form-group">
        <div class="form-row">
          <label class="form-label-left">çµ¦æ–™ã®<br>å€‹åˆ¥è¨­å®š</label>
          <div class="form-value-right">
            <span class="not-set">æœªè¨­å®š</span>
          </div>
        </div>
      </div>

      <!-- ãƒ¡ãƒ¢ -->
      <div class="shiftboard-form-group">
        <div class="form-row">
          <label class="form-label-left">ãƒ¡ãƒ¢</label>
          <div class="form-value-right">
            <textarea class="shiftboard-memo" id="shiftMemo" placeholder="æœªå…¥åŠ›"></textarea>
          </div>
        </div>
      </div>

      <!-- å®Œäº†ãƒœã‚¿ãƒ³ -->
      <button class="complete-btn-green" onclick="saveShift()">å®Œäº†ã™ã‚‹</button>

      <div class="form-group">
        <label class="form-label">
          äºˆæƒ³åå…¥: <span id="predictedEarnings">0å††</span>
        </label>
      </div>

      <div style="display: flex; gap: 12px; margin-top: 20px;">
        <button class="btn btn-danger" onclick="deleteShift()" style="flex: 1;" id="deleteShiftBtn">
          å‰Šé™¤
        </button>
        <button class="btn btn-primary" onclick="saveShift()" style="flex: 2;">
          ä¿å­˜
        </button>
      </div>
    </div>

    <!-- ãƒ•ãƒ¬ã‚­ã‚·ãƒ–ãƒ«æ™‚é–“å¸¯è¨­å®šãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    <div class="popup" id="flexibleRatePopup" style="min-width: 500px; display: none;">
      <div class="popup-header">
        <div class="popup-title">â° æ™‚é–“å¸¯åˆ¥å‰²å¢—è¨­å®š</div>
        <button class="close-btn" onclick="closeFlexibleRateConfig()">&times;</button>
      </div>

      <div id="flexibleRateSlots">
        <!-- JavaScript ã§å‹•çš„ç”Ÿæˆ -->
      </div>

      <button class="btn btn-secondary" onclick="addFlexibleTimeSlot()" style="width: 100%; margin: 12px 0;">
        â• æ™‚é–“å¸¯ã‚’è¿½åŠ 
      </button>

      <div style="display: flex; gap: 12px;">
        <button class="btn btn-secondary" onclick="closeFlexibleRateConfig()" style="flex: 1;">
          ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        </button>
        <button class="btn btn-primary" onclick="saveFlexibleRateConfig()" style="flex: 2;">
          ä¿å­˜
        </button>
      </div>
    </div>

    <script>
      // ç¾åœ¨ã®æ—¥ä»˜
      let currentDate = new Date();
      
      // ãƒ‡ãƒ¼ã‚¿ç®¡ç†ï¼ˆLocalStorageï¼‰
      let workplaces = JSON.parse(localStorage.getItem('workplaces') || '{}');
      let shifts = JSON.parse(localStorage.getItem('shifts') || '{}');
      let workplaceIdCounter = parseInt(
        localStorage.getItem('workplaceIdCounter') || '1'
      );
      let editingWorkplaceId = null;
      let currentFlexibleRates = [];
      let flexibleRateIdCounter = 1;

      // æœˆå¤‰æ›´
      function changeMonth(direction) {
        currentDate.setMonth(currentDate.getMonth() + direction);
        updateCalendar();
      }

      // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ›´æ–°
      function updateCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        
        // æœˆã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°
        document.getElementById('currentMonth').textContent = 
          `${year}å¹´${month + 1}æœˆ`;

        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚°ãƒªãƒƒãƒ‰ä½œæˆ - Asia/TokyoåŸºæº–
        const grid = document.getElementById('calendarGrid');
        grid.innerHTML = '';

        // Asia/Tokyoã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã§æ­£ç¢ºãªæ—¥ä»˜è¨ˆç®—
        const firstDay = new Date(year, month, 1);
        const firstWeekday = firstDay.getDay(); // 0=æ—¥æ›œ
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        
        // å¿…è¦æœ€å°é™ã®ã‚»ãƒ«æ•°è¨ˆç®—
        const leading = firstWeekday; // å‰æœˆã®æ—¥æ•°
        const totalCells = leading + daysInMonth;
        const trailing = Math.ceil(totalCells / 7) * 7 - totalCells; // æ¥æœˆã®æ—¥æ•°ï¼ˆæœ€å°é™ï¼‰
        const maxCells = leading + daysInMonth + trailing;

        console.log(`ğŸ“… ${year}å¹´${month+1}æœˆ: å…ˆé ­${leading}æ—¥ + æœ¬æœˆ${daysInMonth}æ—¥ + æœ«å°¾${trailing}æ—¥ = è¨ˆ${maxCells}ã‚»ãƒ«`);

        const today = new Date();
        let monthlyEarnings = 0;
        let monthlyDays = 0;
        let monthlyHours = 0;

        for (let i = 0; i < maxCells; i++) {
          // æ­£ç¢ºãªæ—¥ä»˜è¨ˆç®—
          let date;
          if (i < leading) {
            // å‰æœˆã®æ—¥ä»˜
            const prevMonth = month === 0 ? 11 : month - 1;
            const prevYear = month === 0 ? year - 1 : year;
            const prevMonthDays = new Date(prevYear, prevMonth + 1, 0).getDate();
            date = new Date(prevYear, prevMonth, prevMonthDays - leading + i + 1);
          } else if (i < leading + daysInMonth) {
            // å½“æœˆã®æ—¥ä»˜
            date = new Date(year, month, i - leading + 1);
          } else {
            // æ¥æœˆã®æ—¥ä»˜
            const nextMonth = month === 11 ? 0 : month + 1;
            const nextYear = month === 11 ? year + 1 : year;
            date = new Date(nextYear, nextMonth, i - leading - daysInMonth + 1);
          }

          const dayElement = document.createElement('div');
          dayElement.className = 'calendar-day';
          
          // æ™‚å·®ã®å½±éŸ¿ã‚’é¿ã‘ã‚‹ãŸã‚ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“ã§ISOæ–‡å­—åˆ—ã‚’ä½œæˆ
          const dateYear = date.getFullYear();
          const dateMonth = String(date.getMonth() + 1).padStart(2, '0');
          const dateDay = String(date.getDate()).padStart(2, '0');
          const dateStr = `${dateYear}-${dateMonth}-${dateDay}`;
          const isCurrentMonth = date.getMonth() === month;
          const isToday = date.toDateString() === today.toDateString();
          const hasShift = shifts[dateStr];

          if (!isCurrentMonth) {
            dayElement.classList.add('other-month');
          }
          if (isToday) {
            dayElement.classList.add('today');
          }
          if (hasShift) {
            dayElement.classList.add('has-shift');
            if (isCurrentMonth) {
              monthlyEarnings += hasShift.earnings;
              monthlyDays++;
              const hours = calculateHours(hasShift.start, hasShift.end);
              monthlyHours += hours;
            }
          }

          // å…¨ã¦ã®æ—¥ä»˜ã‚’è¡¨ç¤ºï¼ˆæœˆå¤–ã®æ—¥ä»˜ã¯è–„ã„è‰²ã§ï¼‰
          const timeDisplay = hasShift ? `${hasShift.start}-${hasShift.end}` : '';
          dayElement.innerHTML = `
            <div class="day-number">${date.getDate()}</div>
            ${hasShift ? `<div class="shift-indicator">${timeDisplay}</div>` : ''}
          `;
          dayElement.onclick = () => showDayDetails(dateStr);
          grid.appendChild(dayElement);
        }

        // ã‚µãƒãƒªãƒ¼æ›´æ–°ã¯å‰Šé™¤ï¼ˆUIéè¡¨ç¤ºã®ãŸã‚ï¼‰
        // document.getElementById('monthlyDays').textContent = `${monthlyDays}æ—¥`;
        // document.getElementById('monthlyEarnings').textContent = `Â¥${monthlyEarnings.toLocaleString()}`;
        // document.getElementById('monthlyHours').textContent = `${monthlyHours}h`;
      }

      // åŠ´åƒæ™‚é–“è¨ˆç®—
      function calculateHours(startTime, endTime) {
        const [startH, startM] = startTime.split(':').map(Number);
        const [endH, endM] = endTime.split(':').map(Number);
        
        let startMinutes = startH * 60 + startM;
        let endMinutes = endH * 60 + endM;
        
        // ç¿Œæ—¥å¯¾å¿œ
        if (endMinutes < startMinutes) {
          endMinutes += 24 * 60;
        }
        
        return (endMinutes - startMinutes) / 60;
      }

      // æ—¥è©³ç´°è¡¨ç¤º
      function showDayDetails(dateStr) {
        const shift = shifts[dateStr];
        if (shift) {
          // æ—¢å­˜ã‚·ãƒ•ãƒˆãŒã‚ã‚‹å ´åˆã¯ç·¨é›†ç”»é¢ã‚’é–‹ã
          openShiftPopup(dateStr);
        } else {
          // æ–°è¦ã‚·ãƒ•ãƒˆä½œæˆ
          openShiftPopup(dateStr);
        }
      }

      // ã‚·ãƒ•ãƒˆè¿½åŠ ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
      function showAddShiftDialog(dateStr = null) {
        if (!dateStr) {
          const today = new Date();
          const year = today.getFullYear();
          const month = String(today.getMonth() + 1).padStart(2, '0');
          const day = String(today.getDate()).padStart(2, '0');
          dateStr = `${year}-${month}-${day}`;
        }
        openShiftPopup(dateStr);
      }

      // ===== è·å ´ç®¡ç†æ©Ÿèƒ½ =====

      // è·å ´ç®¡ç†ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‹ã
      function openWorkplaceManager() {
        document.getElementById('popupOverlay').style.display = 'block';
        document.getElementById('workplacePopup').style.display = 'block';
        renderWorkplaceList();
      }

      // è·å ´ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã
      function openWorkplaceForm(workplaceId = null) {
        editingWorkplaceId = workplaceId;
        document.getElementById('workplacePopup').style.display = 'none';
        document.getElementById('workplaceFormPopup').style.display = 'block';

        if (workplaceId) {
          // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰
          document.getElementById('workplaceFormTitle').textContent = 'ãƒã‚¤ãƒˆå…ˆã‚’ç·¨é›†';
          loadWorkplaceForm(workplaces[workplaceId]);
        } else {
          // æ–°è¦ä½œæˆãƒ¢ãƒ¼ãƒ‰
          document.getElementById('workplaceFormTitle').textContent = 'æ–°ã—ã„ãƒã‚¤ãƒˆå…ˆã‚’è¿½åŠ ';
          clearWorkplaceForm();
        }
      }

      // è·å ´ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
      function clearWorkplaceForm() {
        document.getElementById('workplaceName').value = '';
        document.getElementById('baseHourlyWage').value = '';
        document.getElementById('transportationFee').value = '0';
        
        // æ·±å¤œè¨­å®šã‚’ã‚¯ãƒªã‚¢
        document.getElementById('nightShiftType').value = 'none';
        currentFlexibleRates = [];
        updateNightShiftFields();
        
        // æ›œæ—¥ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ã‚¯ãƒªã‚¢
        ['0', '1', '2', '3', '4', '5', '6'].forEach(day => {
          const checkbox = document.getElementById(`dayPremium_${day}`);
          if (checkbox) checkbox.checked = false;
        });
        
        document.getElementById('dayPremiumRate').value = '';
        document.getElementById('dayPremiumType').value = 'fixed';
        updateDayPremiumFields();
      }

      // è·å ´ãƒ•ã‚©ãƒ¼ãƒ ã«æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
      function loadWorkplaceForm(workplace) {
        document.getElementById('workplaceName').value = workplace.name;
        document.getElementById('baseHourlyWage').value = workplace.baseHourly;
        document.getElementById('transportationFee').value = workplace.transportation || 0;

        // æ·±å¤œãƒ»æ™‚é–“å¸¯åˆ¥è¨­å®š
        document.getElementById('nightShiftType').value = workplace.nightRate?.type || 'none';
        if (workplace.flexibleRates) {
          currentFlexibleRates = [...workplace.flexibleRates];
        }
        updateNightShiftFields();

        // æ›œæ—¥åˆ¥è¨­å®š
        if (workplace.dayPremium && workplace.dayPremium.enabled) {
          workplace.dayPremium.days.forEach(day => {
            const checkbox = document.getElementById(`dayPremium_${day}`);
            if (checkbox) checkbox.checked = true;
          });
          
          document.getElementById('dayPremiumRate').value = workplace.dayPremium.rate;
          document.getElementById('dayPremiumType').value = workplace.dayPremium.type || 'fixed';
        }
        
        updateDayPremiumFields();
      }

      // è·å ´ãƒªã‚¹ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
      function renderWorkplaceList() {
        const listElement = document.getElementById('workplaceList');
        const workplaceEntries = Object.entries(workplaces);

        if (workplaceEntries.length === 0) {
          listElement.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">ã¾ã ãƒã‚¤ãƒˆå…ˆãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</div>';
          return;
        }

        listElement.innerHTML = workplaceEntries
          .map(([id, workplace]) => `
            <div class="workplace-item">
              <div class="workplace-info">
                <h4>${workplace.name}</h4>
                <p>åŸºæœ¬æ™‚çµ¦: ${workplace.baseHourly}å†† | äº¤é€šè²»: ${workplace.transportation || 0}å††</p>
              </div>
              <div class="workplace-actions">
                <button class="btn btn-secondary btn-small" onclick="openWorkplaceForm('${id}')">ç·¨é›†</button>
                <button class="btn btn-danger btn-small" onclick="deleteWorkplace('${id}')">å‰Šé™¤</button>
              </div>
            </div>
          `)
          .join('');
      }

      // è·å ´ã‚’ä¿å­˜
      function saveWorkplace() {
        const name = document.getElementById('workplaceName').value.trim();
        const baseHourly = parseInt(document.getElementById('baseHourlyWage').value);

        if (!name || !baseHourly || baseHourly <= 0) {
          alert('è·å ´åã¨åŸºæœ¬æ™‚çµ¦ã¯å¿…é ˆã§ã™ã€‚');
          return;
        }

        const workplace = {
          name: name,
          baseHourly: baseHourly,
          transportation: parseInt(document.getElementById('transportationFee').value) || 0
        };

        // æ·±å¤œãƒ»æ™‚é–“å¸¯åˆ¥è¨­å®š
        const nightShiftType = document.getElementById('nightShiftType').value;
        if (nightShiftType && nightShiftType !== 'none') {
          workplace.nightRate = {
            enabled: true,
            multiplier: nightShiftType === 'legal' ? 1.25 : 1.25,
            type: nightShiftType
          };
        }

        if (nightShiftType === 'flexible') {
          workplace.flexibleRates = [...currentFlexibleRates];
        }

        // æ›œæ—¥åˆ¥è¨­å®š
        const selectedDays = [];
        ['0', '1', '2', '3', '4', '5', '6'].forEach(day => {
          if (document.getElementById(`dayPremium_${day}`)?.checked) {
            selectedDays.push(parseInt(day));
          }
        });

        if (selectedDays.length > 0) {
          const rate = parseFloat(document.getElementById('dayPremiumRate').value);
          const type = document.getElementById('dayPremiumType').value;

          if (rate && rate > 0) {
            workplace.dayPremium = {
              enabled: true,
              days: selectedDays,
              rate: rate,
              type: type,
              multiplier: type === 'fixed' ? rate / baseHourly : 1 + (rate / 100)
            };
          }
        }

        // ä¿å­˜
        const workplaceId = editingWorkplaceId || `workplace-${workplaceIdCounter++}`;
        workplaces[workplaceId] = workplace;

        localStorage.setItem('workplaces', JSON.stringify(workplaces));
        localStorage.setItem('workplaceIdCounter', workplaceIdCounter.toString());

        closeWorkplaceForm();
        renderWorkplaceList();
        updateShiftWorkplaceOptions();
      }

      // è·å ´ã‚’å‰Šé™¤
      function deleteWorkplace(workplaceId) {
        if (confirm('ã“ã®ãƒã‚¤ãƒˆå…ˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
          delete workplaces[workplaceId];
          localStorage.setItem('workplaces', JSON.stringify(workplaces));
          renderWorkplaceList();
          updateShiftWorkplaceOptions();
        }
      }

      // è·å ´ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‰ã˜ã‚‹
      function closeWorkplaceForm() {
        document.getElementById('workplaceFormPopup').style.display = 'none';
        document.getElementById('workplacePopup').style.display = 'block';
      }

      // æ›œæ—¥åˆ¥è¨­å®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¡¨ç¤º/éè¡¨ç¤º
      function updateDayPremiumFields() {
        const hasSelectedDays = Array.from(
          document.querySelectorAll('[id^="dayPremium_"]')
        ).some(checkbox => checkbox.checked);

        const rateInput = document.getElementById('dayPremiumRate');
        const typeSelect = document.getElementById('dayPremiumType');

        rateInput.disabled = !hasSelectedDays;
        typeSelect.disabled = !hasSelectedDays;

        // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’å‹•çš„ã«æ›´æ–°
        if (hasSelectedDays) {
          const baseHourly = parseInt(document.getElementById('baseHourlyWage').value) || 1000;
          const type = typeSelect.value;

          if (type === 'fixed') {
            rateInput.placeholder = `${baseHourly + 100} (å††)`;
          } else if (type === 'rate') {
            rateInput.placeholder = '10 (%)';
          }
        } else {
          rateInput.placeholder = 'æ™‚çµ¦ (å††)';
        }
      }

      // æ·±å¤œè¨­å®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¡¨ç¤º/éè¡¨ç¤º
      function updateNightShiftFields() {
        const nightShiftType = document.getElementById('nightShiftType').value;
        const configureButton = document.getElementById('configureFlexible');
        const display = document.getElementById('flexibleRatesDisplay');

        if (nightShiftType === 'flexible') {
          configureButton.style.display = 'block';
          updateFlexibleRatesDisplay();
        } else {
          configureButton.style.display = 'none';
          display.style.display = 'none';
        }
      }

      // ãƒ•ãƒ¬ã‚­ã‚·ãƒ–ãƒ«ãƒ¬ãƒ¼ãƒˆè¨­å®šã‚’é–‹ã
      function openFlexibleRateConfig() {
        currentFlexibleRates = [
          ...(editingWorkplaceId && workplaces[editingWorkplaceId]?.flexibleRates || [])
        ];
        if (currentFlexibleRates.length === 0) {
          addFlexibleTimeSlot();
        }
        document.getElementById('flexibleRatePopup').style.display = 'block';
        renderFlexibleRateSlots();
      }

      // ãƒ•ãƒ¬ã‚­ã‚·ãƒ–ãƒ«ãƒ¬ãƒ¼ãƒˆè¨­å®šã‚’é–‰ã˜ã‚‹
      function closeFlexibleRateConfig() {
        document.getElementById('flexibleRatePopup').style.display = 'none';
      }

      // ãƒ•ãƒ¬ã‚­ã‚·ãƒ–ãƒ«æ™‚é–“å¸¯ã‚’è¿½åŠ 
      function addFlexibleTimeSlot(startTime = '22:00', endTime = '05:00', rate = 125) {
        currentFlexibleRates.push({
          id: flexibleRateIdCounter++,
          startTime: startTime,
          endTime: endTime,
          rate: rate,
          crossMidnight: true
        });
        renderFlexibleRateSlots();
      }

      // ãƒ•ãƒ¬ã‚­ã‚·ãƒ–ãƒ«æ™‚é–“å¸¯ã‚’å‰Šé™¤
      function removeFlexibleTimeSlot(id) {
        currentFlexibleRates = currentFlexibleRates.filter(slot => slot.id !== id);
        renderFlexibleRateSlots();
      }

      // ãƒ•ãƒ¬ã‚­ã‚·ãƒ–ãƒ«ãƒ¬ãƒ¼ãƒˆã‚¹ãƒ­ãƒƒãƒˆã‚’æç”»
      function renderFlexibleRateSlots() {
        const container = document.getElementById('flexibleRateSlots');
        
        container.innerHTML = currentFlexibleRates.map(slot => `
          <div class="form-group" style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 12px; margin-bottom: 12px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr 100px auto; gap: 12px; align-items: end;">
              <div>
                <label style="font-size: 12px; color: #666;">é–‹å§‹æ™‚é–“</label>
                <input type="time" class="form-input" value="${slot.startTime}" 
                       onchange="updateFlexibleSlot(${slot.id}, 'startTime', this.value)">
              </div>
              <div>
                <label style="font-size: 12px; color: #666;">çµ‚äº†æ™‚é–“</label>
                <input type="time" class="form-input" value="${slot.endTime}"
                       onchange="updateFlexibleSlot(${slot.id}, 'endTime', this.value)">
                <label style="font-size: 11px; color: #888;">
                  <input type="checkbox" ${slot.crossMidnight ? 'checked' : ''} 
                         onchange="updateFlexibleSlot(${slot.id}, 'crossMidnight', this.checked)" style="margin-right: 4px;">ç¿Œæ—¥
                </label>
              </div>
              <div>
                <label style="font-size: 12px; color: #666;">å‰²å¢—ç‡(%)</label>
                <input type="number" class="form-input" value="${slot.rate}" min="100" max="200"
                       onchange="updateFlexibleSlot(${slot.id}, 'rate', parseFloat(this.value))">
              </div>
              <button type="button" class="btn btn-danger btn-small" onclick="removeFlexibleTimeSlot(${slot.id})">å‰Šé™¤</button>
            </div>
          </div>
        `).join('');
      }

      // ãƒ•ãƒ¬ã‚­ã‚·ãƒ–ãƒ«ã‚¹ãƒ­ãƒƒãƒˆã®å€¤ã‚’æ›´æ–°
      function updateFlexibleSlot(id, field, value) {
        const slot = currentFlexibleRates.find(s => s.id === id);
        if (slot) {
          slot[field] = value;
        }
      }

      // ãƒ•ãƒ¬ã‚­ã‚·ãƒ–ãƒ«ãƒ¬ãƒ¼ãƒˆè¨­å®šã‚’ä¿å­˜
      function saveFlexibleRateConfig() {
        updateFlexibleRatesDisplay();
        closeFlexibleRateConfig();
      }

      // ãƒ•ãƒ¬ã‚­ã‚·ãƒ–ãƒ«ãƒ¬ãƒ¼ãƒˆè¡¨ç¤ºã‚’æ›´æ–°
      function updateFlexibleRatesDisplay() {
        const display = document.getElementById('flexibleRatesDisplay');
        const list = document.getElementById('flexibleRatesList');

        if (currentFlexibleRates.length === 0) {
          display.style.display = 'none';
          return;
        }

        display.style.display = 'block';
        list.innerHTML = currentFlexibleRates
          .map(slot => `${slot.startTime}-${slot.endTime} (${slot.rate}%)`)
          .join(' â€¢ ');
      }

      // ===== ã‚·ãƒ•ãƒˆç®¡ç†æ©Ÿèƒ½ =====

      // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‹ã
      function openShiftPopup(date) {
        const formattedDate = new Date(date).toLocaleDateString('ja-JP', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });

        document.getElementById('popupDate').textContent = formattedDate;
        document.getElementById('shiftDate').value = date;
        document.getElementById('popupOverlay').style.display = 'block';
        document.getElementById('shiftPopup').style.display = 'block';

        // è·å ´é¸æŠè‚¢ã‚’æ›´æ–°
        updateShiftWorkplaceOptions();

        // æ—¢å­˜ã‚·ãƒ•ãƒˆãŒã‚ã‚Œã°è¨­å®š
        const shift = shifts[date];
        if (shift) {
          document.getElementById('workplaceSelect').value = shift.workplace;
          document.getElementById('startTime').value = shift.start;
          document.getElementById('endTime').value = shift.end;
          document.getElementById('crossMidnight').checked = shift.crossMidnight || false;
          
          // ã‚¿ã‚¤ãƒˆãƒ«ã‚’ã€Œç·¨é›†ã€ã«å¤‰æ›´
          document.getElementById('popupDate').textContent = 
            new Date(date).toLocaleDateString('ja-JP', {
              year: 'numeric',
              month: 'long', 
              day: 'numeric'
            }) + ' ã®ã‚·ãƒ•ãƒˆç·¨é›†';
            
          updatePredictedEarnings();
        } else {
          // ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢ï¼ˆæ–°è¦ä½œæˆï¼‰
          if (document.getElementById('workplaceSelect').options.length > 0) {
            document.getElementById('workplaceSelect').selectedIndex = 0;
          }
          document.getElementById('startTime').value = '10:00';
          document.getElementById('endTime').value = '18:00';
          document.getElementById('crossMidnight').checked = false;
          
          // ã‚¿ã‚¤ãƒˆãƒ«ã‚’ã€Œç™»éŒ²ã€ã«å¤‰æ›´
          document.getElementById('popupDate').textContent = 
            new Date(date).toLocaleDateString('ja-JP', {
              year: 'numeric',
              month: 'long',
              day: 'numeric'
            }) + ' ã®ã‚·ãƒ•ãƒˆç™»éŒ²';
            
          updatePredictedEarnings();
        }

        // å‰Šé™¤ãƒœã‚¿ãƒ³ã®è¡¨ç¤º/éè¡¨ç¤º
        const deleteBtn = document.getElementById('deleteShiftBtn');
        if (shift) {
          deleteBtn.style.display = 'block';
        } else {
          deleteBtn.style.display = 'none';
        }
      }

      // ã‚·ãƒ•ãƒˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
      function closeShiftPopup() {
        document.getElementById('popupOverlay').style.display = 'none';
        document.getElementById('shiftPopup').style.display = 'none';
      }

      // å…¨ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
      function closePopups() {
        document.getElementById('popupOverlay').style.display = 'none';
        document.getElementById('workplacePopup').style.display = 'none';
        document.getElementById('workplaceFormPopup').style.display = 'none';
        document.getElementById('shiftPopup').style.display = 'none';
        editingWorkplaceId = null;
      }

      // åå…¥äºˆæ¸¬æ›´æ–°
      function updatePredictedEarnings() {
        const workplaceId = document.getElementById('workplaceSelect').value;
        const startTime = document.getElementById('startTime').value;
        const endTime = document.getElementById('endTime').value;
        const crossMidnight = document.getElementById('crossMidnight')?.checked || false;

        if (!workplaceId || !startTime || !endTime) {
          document.getElementById('predictedEarnings').textContent = '0å††';
          return;
        }

        const workDate = document.getElementById('shiftDate').value; // æ—¥ä»˜ã‚’å–å¾—
        const result = calculateExactEarnings(workplaceId, startTime, endTime, crossMidnight, workDate);
        document.getElementById('predictedEarnings').textContent = `${result.totalEarnings.toLocaleString()}å††`;
      }

      // ã‚·ãƒ•ãƒˆã‚’ä¿å­˜
      function saveShift() {
        const date = document.getElementById('shiftDate').value;
        const workplaceId = document.getElementById('workplaceSelect').value;
        const startTime = document.getElementById('startTime').value;
        const endTime = document.getElementById('endTime').value;
        const crossMidnight = document.getElementById('crossMidnight')?.checked || false;

        if (!workplaceId || !startTime || !endTime) {
          alert('ãƒã‚¤ãƒˆå…ˆã€é–‹å§‹æ™‚é–“ã€çµ‚äº†æ™‚é–“ã‚’å…¨ã¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
          return;
        }

        if (!workplaces[workplaceId]) {
          alert('é¸æŠã•ã‚ŒãŸãƒã‚¤ãƒˆå…ˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
          return;
        }

        // åå…¥è¨ˆç®—
        const result = calculateExactEarnings(workplaceId, startTime, endTime, crossMidnight, date);

        // ã‚·ãƒ•ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ
        const shift = {
          date: date,
          workplace: workplaceId,
          start: startTime,
          end: endTime,
          crossMidnight: crossMidnight,
          hours: result.hours,
          earnings: result.totalEarnings
        };

        // ä¿å­˜
        shifts[date] = shift;
        localStorage.setItem('shifts', JSON.stringify(shifts));

        closeShiftPopup();
        updateCalendar();
      }

      // ã‚·ãƒ•ãƒˆã‚’å‰Šé™¤
      function deleteShift() {
        const date = document.getElementById('shiftDate').value;
        if (confirm('ã“ã®ã‚·ãƒ•ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
          delete shifts[date];
          localStorage.setItem('shifts', JSON.stringify(shifts));
          closeShiftPopup();
          updateCalendar();
        }
      }

      // ã‚·ãƒ•ãƒˆã®è·å ´é¸æŠè‚¢ã‚’æ›´æ–°
      function updateShiftWorkplaceOptions() {
        const selectElement = document.getElementById('workplaceSelect');
        const workplaceEntries = Object.entries(workplaces);

        if (workplaceEntries.length === 0) {
          selectElement.innerHTML = '<option value="">ã¾ãšãƒã‚¤ãƒˆå…ˆã‚’ç™»éŒ²ã—ã¦ãã ã•ã„</option>';
          return;
        }

        selectElement.innerHTML = workplaceEntries
          .map(
            ([id, workplace]) =>
              `<option value="${id}">${workplace.name} (æ™‚çµ¦${workplace.baseHourly}å††)</option>`
          )
          .join('');
      }

      // ===== æ­£ç¢ºãªåå…¥è¨ˆç®— =====

      function calculateExactEarnings(workplaceId, startTime, endTime, crossMidnight = false, workDate = null) {
        const workplace = workplaces[workplaceId];
        if (!workplace) return { totalEarnings: 0, breakdown: [], hours: 0 };

        console.log('=== åå…¥è¨ˆç®—é–‹å§‹ ===');
        console.log('è·å ´:', workplace.name);
        console.log('å‹¤å‹™æ™‚é–“:', `${startTime} - ${endTime}`);
        console.log('ç¿Œæ—¥ãƒ•ãƒ©ã‚°:', crossMidnight);

        const breakdown = [];
        let totalEarnings = 0;

        // åŠ´åƒæ™‚é–“è¨ˆç®—
        const totalHours = calculateHours(startTime, endTime);
        console.log('åŠ´åƒæ™‚é–“:', totalHours, 'h');

        // åŸºæœ¬æ™‚çµ¦ã‚’æ±ºå®šï¼ˆæ›œæ—¥åˆ¥è¨­å®šãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ï¼‰
        let hourlyRate = workplace.baseHourly;
        let isWeekendPremium = false;

        // æ›œæ—¥ã®å–å¾—
        let dayOfWeek;
        if (workDate) {
          // workDateãŒæ–‡å­—åˆ—ã®å ´åˆï¼ˆYYYY-MM-DDå½¢å¼ï¼‰ã‚’æ­£ã—ããƒ‘ãƒ¼ã‚¹
          const dateStr = typeof workDate === 'string' ? workDate : workDate.toString();
          console.log('ğŸ” workDateæ–‡å­—åˆ—:', dateStr);
          const [year, month, day] = dateStr.split('-').map(n => parseInt(n));
          const dateObj = new Date(year, month - 1, day);
          dayOfWeek = dateObj.getDay(); // monthã¯0ãƒ™ãƒ¼ã‚¹
          console.log('ğŸ“… ãƒ‘ãƒ¼ã‚¹çµæœ:', {
            input: `${year}-${month}-${day}`,
            dateObject: dateObj.toDateString(),
            dayOfWeek: dayOfWeek
          });
          
          // å®Ÿéš›ã®æ›œæ—¥åã‚’ãƒã‚§ãƒƒã‚¯
          const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
          console.log('ğŸ—“ï¸ åˆ¤å®šã•ã‚ŒãŸæ›œæ—¥:', dayNames[dayOfWeek]);
          
          // ã•ã‚‰ã«è©³ç´°ç¢ºèªã®ãŸã‚
          console.log('ğŸ§® è©³ç´°:', {
            å¹´: year,
            æœˆ: month,
            æ—¥: day,
            'Dateä½œæˆæ™‚ã®æœˆ': month - 1,
            'getDayçµæœ': dayOfWeek
          });
        } else {
          dayOfWeek = new Date().getDay();
          console.log('ç¾åœ¨ã®æ›œæ—¥:', dayOfWeek);
        }

        console.log('æ›œæ—¥:', dayOfWeek, '(0:æ—¥ 1:æœˆ ... 6:åœŸ)');

        // æ›œæ—¥åˆ¥å‰²å¢—ã®ç¢ºèª
        console.log('æ›œæ—¥åˆ¥è¨­å®šãƒã‚§ãƒƒã‚¯:', workplace.dayPremium);
        if (workplace.dayPremium && workplace.dayPremium.enabled && workplace.dayPremium.days) {
          console.log('è¨­å®šå¯¾è±¡æ›œæ—¥:', workplace.dayPremium.days, 'ä»Šæ—¥ã®æ›œæ—¥:', dayOfWeek);
          if (workplace.dayPremium.days.includes(dayOfWeek)) {
            // multiplierã‚’å†è¨ˆç®—ã—ã¦ç¢ºå®Ÿã«é©ç”¨
            let multiplier;
            if (workplace.dayPremium.type === 'fixed') {
              multiplier = workplace.dayPremium.rate / workplace.baseHourly;
              hourlyRate = workplace.dayPremium.rate;
            } else {
              multiplier = 1 + (workplace.dayPremium.rate / 100);
              hourlyRate = workplace.baseHourly * multiplier;
            }
            isWeekendPremium = true;

            const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
            breakdown.push(
              `${dayNames[dayOfWeek]}æ›œæ—¥å‰²å¢—: ${workplace.baseHourly}å†† â†’ ${Math.round(hourlyRate)}å†† (${workplace.dayPremium.type === 'fixed' ? 'å›ºå®š' : 'Ã—' + multiplier.toFixed(2)})`
            );
            console.log('æ›œæ—¥å‰²å¢—é©ç”¨:', {
              base: workplace.baseHourly,
              type: workplace.dayPremium.type,
              rate: workplace.dayPremium.rate,
              multiplier: multiplier,
              result: hourlyRate
            });
          } else {
            console.log('æ›œæ—¥å‰²å¢—å¯¾è±¡å¤–');
          }
        } else {
          console.log('æ›œæ—¥åˆ¥è¨­å®šãªã—');
        }

        // åŸºæœ¬æ™‚çµ¦è¨ˆç®—
        let baseEarnings = totalHours * hourlyRate;
        totalEarnings += baseEarnings;

        if (isWeekendPremium) {
          breakdown.push(
            `å‰²å¢—çµ¦ä¸: ${totalHours}h Ã— ${Math.round(hourlyRate)}å†† = ${Math.round(baseEarnings)}å††`
          );
        } else {
          breakdown.push(
            `åŸºæœ¬çµ¦: ${totalHours}h Ã— ${hourlyRate}å†† = ${Math.round(baseEarnings)}å††`
          );
        }

        // æ·±å¤œãƒ»æ™‚é–“å¸¯åˆ¥æ‰‹å½“è¨ˆç®—
        if (workplace.nightRate && workplace.nightRate.enabled) {
          if (workplace.nightRate.type === 'legal') {
            // æ³•å®šæ·±å¤œå‰²å¢—ï¼ˆ22:00-5:00, 25%ï¼‰
            const nightHours = calculateNightHours(startTime, endTime, crossMidnight);
            console.log('æ·±å¤œæ™‚é–“:', nightHours, 'h');

            if (nightHours > 0) {
              // æ›œæ—¥åˆ¥å‰²å¢—ãŒé©ç”¨ã•ã‚ŒãŸæ™‚çµ¦ãƒ™ãƒ¼ã‚¹ã§æ·±å¤œæ‰‹å½“ã‚’è¨ˆç®—
              const nightBonus = nightHours * hourlyRate * 0.25; // 25%å‰²å¢—
              totalEarnings += nightBonus;
              breakdown.push(
                `æ·±å¤œæ‰‹å½“: ${nightHours.toFixed(2)}h Ã— ${Math.round(hourlyRate)}å†† Ã— 25% = ${Math.round(nightBonus)}å††`
              );
              console.log('æ·±å¤œæ‰‹å½“é©ç”¨:', {
                hours: nightHours,
                baseRate: hourlyRate,
                bonus: nightBonus
              });
            }
          } else if (workplace.nightRate.type === 'flexible' && workplace.flexibleRates) {
            // ãƒ•ãƒ¬ã‚­ã‚·ãƒ–ãƒ«æ™‚é–“å¸¯å‰²å¢—
            const flexibleBonus = calculateFlexibleRateEarnings(
              workplace.flexibleRates,
              startTime,
              endTime,
              crossMidnight,
              hourlyRate  // æ›œæ—¥åˆ¥å‰²å¢—ãŒé©ç”¨ã•ã‚ŒãŸæ™‚çµ¦ã‚’ä½¿ç”¨
            );
            if (flexibleBonus.total > 0) {
              totalEarnings += flexibleBonus.total;
              breakdown.push(...flexibleBonus.breakdown);
              console.log('ãƒ•ãƒ¬ã‚­ã‚·ãƒ–ãƒ«æ™‚é–“å¸¯æ‰‹å½“é©ç”¨:', flexibleBonus.total, 'å††');
            }
          }
        }

        // äº¤é€šè²»è¨ˆç®—
        if (workplace.transportation && workplace.transportation > 0) {
          totalEarnings += workplace.transportation;
          breakdown.push(`äº¤é€šè²»: ${workplace.transportation}å††`);
        }

        console.log('æœ€çµ‚è¨ˆç®—çµæœ:', Math.round(totalEarnings), 'å††');
        console.log('========================');

        return {
          totalEarnings: Math.round(totalEarnings),
          breakdown: breakdown,
          hours: totalHours,
        };
      }

      // æ·±å¤œæ™‚é–“ã®è¨ˆç®—ï¼ˆ22æ™‚-5æ™‚ï¼‰
      function calculateNightHours(startTime, endTime, crossMidnight = false) {
        const [startHour, startMin] = startTime.split(':').map(Number);
        let [endHour, endMin] = endTime.split(':').map(Number);

        let startMinutes = startHour * 60 + startMin;
        let endMinutes = endHour * 60 + endMin;

        // ç¿Œæ—¥å¯¾å¿œ
        if (crossMidnight && endMinutes < startMinutes) {
          endMinutes += 24 * 60;
        }

        let nightMinutes = 0;

        // 1åˆ†ã”ã¨ã«æ·±å¤œæ™‚é–“ã‚’ãƒã‚§ãƒƒã‚¯
        for (let minute = startMinutes; minute < endMinutes; minute++) {
          const currentHour = Math.floor(minute / 60) % 24;
          if (currentHour >= 22 || currentHour < 5) {
            nightMinutes++;
          }
        }

        const nightHours = nightMinutes / 60;
        console.log('æ·±å¤œæ™‚é–“è©³ç´°:', {
          start: startTime,
          end: endTime,
          crossMidnight,
          startMinutes,
          endMinutes,
          nightMinutes,
          nightHours
        });

        return nightHours; // æ™‚é–“ã«å¤‰æ›
      }

      // ãƒ•ãƒ¬ã‚­ã‚·ãƒ–ãƒ«æ™‚é–“å¸¯ã§ã®åå…¥è¨ˆç®—
      function calculateFlexibleRateEarnings(flexibleRates, startTime, endTime, crossMidnight, baseHourlyRate) {
        console.log('ãƒ•ãƒ¬ã‚­ã‚·ãƒ–ãƒ«æ™‚é–“å¸¯è¨ˆç®—é–‹å§‹:', flexibleRates);
        
        let totalBonus = 0;
        const breakdown = [];
        
        const [startHour, startMin] = startTime.split(':').map(Number);
        let [endHour, endMin] = endTime.split(':').map(Number);

        if (crossMidnight && endHour < startHour) {
          endHour += 24;
        }

        // å„ãƒ•ãƒ¬ã‚­ã‚·ãƒ–ãƒ«æ™‚é–“å¸¯ã‚’ãƒã‚§ãƒƒã‚¯
        flexibleRates.forEach((slot, index) => {
          const slotHours = calculateTimeInSlot(
            startHour * 60 + startMin,
            endHour * 60 + endMin,
            slot
          );
          
          if (slotHours > 0) {
            const rateMultiplier = slot.rate / 100;
            const bonusAmount = slotHours * baseHourlyRate * (rateMultiplier - 1);
            totalBonus += bonusAmount;
            
            breakdown.push(
              `æ™‚é–“å¸¯${index + 1}(${slot.startTime}-${slot.endTime}, ${slot.rate}%): ` +
              `${slotHours.toFixed(2)}h Ã— ${Math.round(baseHourlyRate)}å†† Ã— ${((rateMultiplier - 1) * 100).toFixed(0)}% = ${Math.round(bonusAmount)}å††`
            );
            console.log(`æ™‚é–“å¸¯${index + 1}é©ç”¨:`, slotHours, 'h', bonusAmount, 'å††');
          }
        });

        return {
          total: Math.round(totalBonus),
          breakdown: breakdown
        };
      }

      // ç‰¹å®šã®æ™‚é–“å¸¯å†…ã§ã®åŠ´åƒæ™‚é–“ã‚’è¨ˆç®—
      function calculateTimeInSlot(workStartMinutes, workEndMinutes, slot) {
        const [slotStartHour, slotStartMin] = slot.startTime.split(':').map(Number);
        let [slotEndHour, slotEndMin] = slot.endTime.split(':').map(Number);

        let slotStartMinutes = slotStartHour * 60 + slotStartMin;
        let slotEndMinutes = slotEndHour * 60 + slotEndMin;

        // ç¿Œæ—¥å¯¾å¿œ
        if (slot.crossMidnight && slotEndMinutes < slotStartMinutes) {
          slotEndMinutes += 24 * 60;
        }

        // å‹¤å‹™æ™‚é–“ã¨æ™‚é–“å¸¯ã®é‡è¤‡éƒ¨åˆ†ã‚’è¨ˆç®—
        const overlapStart = Math.max(workStartMinutes, slotStartMinutes);
        const overlapEnd = Math.min(workEndMinutes, slotEndMinutes);

        if (overlapEnd > overlapStart) {
          return (overlapEnd - overlapStart) / 60; // æ™‚é–“ã«å¤‰æ›
        }

        return 0;
      }

      // åˆæœŸåŒ–
      document.addEventListener('DOMContentLoaded', function() {
        updateCalendar();
        initSwipeGestures(); // ã‚¹ãƒ¯ã‚¤ãƒ—æ©Ÿèƒ½åˆæœŸåŒ–
        
        // è·å ´ãŒç©ºã®å ´åˆã¯æ³¨æ„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        if (Object.keys(workplaces).length === 0) {
          console.log('ãƒã‚¤ãƒˆå…ˆãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã¾ãšã€Œãƒã‚¤ãƒˆå…ˆã‚’ç®¡ç†ã€ã‹ã‚‰è·å ´ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚');
        }
      });

      // ã‚¹ãƒ¯ã‚¤ãƒ—æ©Ÿèƒ½ã®æº–å‚™ï¼ˆå°†æ¥ã®ã‚¢ãƒ—ãƒªåŒ–å¯¾å¿œï¼‰
      function initSwipeGestures() {
        const calendar = document.querySelector('.calendar');
        if (!calendar) return;
        
        let startX = null;
        let startY = null;
        
        calendar.addEventListener('touchstart', function(e) {
          startX = e.touches[0].clientX;
          startY = e.touches[0].clientY;
        });
        
        calendar.addEventListener('touchend', function(e) {
          if (!startX || !startY) return;
          
          const endX = e.changedTouches[0].clientX;
          const endY = e.changedTouches[0].clientY;
          
          const diffX = startX - endX;
          const diffY = startY - endY;
          
          // æ¨ªã‚¹ãƒ¯ã‚¤ãƒ—ãŒç¸¦ã‚¹ãƒ¯ã‚¤ãƒ—ã‚ˆã‚Šå¤§ããã€50pxä»¥ä¸Šã®å ´åˆ
          if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
            if (diffX > 0) {
              // å·¦ã‚¹ãƒ¯ã‚¤ãƒ—ï¼ˆæ¬¡æœˆï¼‰
              changeMonth(1);
            } else {
              // å³ã‚¹ãƒ¯ã‚¤ãƒ—ï¼ˆå‰æœˆï¼‰  
              changeMonth(-1);
            }
          }
          
          startX = null;
          startY = null;
        });
        
        console.log('ğŸ“± ã‚¹ãƒ¯ã‚¤ãƒ—æ©Ÿèƒ½ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸ');
      }
    </script>
    
    <!-- Force deploy: Mon Jul 21 23:35:00 JST 2025 -->
  </body>
</html>