<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>扶養プロ 包括的動作確認テスト</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 32px;
            color: #333;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        .test-card { 
            background: #f8f9fa; 
            padding: 20px; 
            border-radius: 12px; 
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }
        .test-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .test-card h3 {
            margin: 0 0 16px;
            color: #495057;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .result { 
            padding: 12px; 
            margin: 12px 0; 
            border-radius: 8px; 
            font-family: 'SF Mono', 'Monaco', 'Cascadia Code', monospace;
            font-size: 14px;
            line-height: 1.4;
            min-height: 100px;
            overflow-y: auto;
            max-height: 300px;
        }
        .success { background: #d1f2eb; color: #0e6b3a; border-left: 4px solid #28a745; }
        .error { background: #f8d7da; color: #721c24; border-left: 4px solid #dc3545; }
        .warning { background: #fff3cd; color: #856404; border-left: 4px solid #ffc107; }
        .info { background: #cce7ff; color: #004085; border-left: 4px solid #007bff; }
        .loading { background: #e2e3e5; color: #6c757d; border-left: 4px solid #6c757d; }
        
        button { 
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 8px; 
            cursor: pointer; 
            margin: 6px 4px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        button:hover { 
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .test-all-btn {
            background: linear-gradient(135deg, #007bff, #0056b3);
            font-size: 16px;
            padding: 16px 32px;
            margin: 20px auto;
            display: block;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #495057;
        }
        .stat-label {
            font-size: 14px;
            color: #6c757d;
        }
        
        .feature-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 8px 0;
        }
        .status-icon {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .status-working { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
        .status-unknown { background: #6c757d; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🧪 扶養プロ 包括的動作確認テスト</h1>
            <p>全機能の動作状況をリアルタイムで確認します</p>
            <button class="test-all-btn" onclick="runAllTests()">🚀 全テスト実行</button>
        </div>

        <div class="test-grid">
            <!-- 基本システム確認 -->
            <div class="test-card">
                <h3>⚙️ 基本システム</h3>
                <button onclick="testBasicSystem()">システム確認</button>
                <div id="basicResult" class="result">テスト未実行</div>
            </div>

            <!-- 設定・構成確認 -->
            <div class="test-card">
                <h3>🔧 設定・構成</h3>
                <button onclick="testConfiguration()">設定確認</button>
                <div id="configResult" class="result">テスト未実行</div>
            </div>

            <!-- AI機能テスト -->
            <div class="test-card">
                <h3>🤖 AI機能</h3>
                <button onclick="testAIFeatures()">AI テスト</button>
                <div id="aiResult" class="result">テスト未実行</div>
            </div>

            <!-- プレミアム機能テスト -->
            <div class="test-card">
                <h3>⭐ プレミアム機能</h3>
                <button onclick="testPremiumFeatures()">プレミアム テスト</button>
                <div id="premiumResult" class="result">テスト未実行</div>
            </div>

            <!-- バックアップ機能テスト -->
            <div class="test-card">
                <h3>💾 バックアップ</h3>
                <button onclick="testBackupFeatures()">バックアップ テスト</button>
                <div id="backupResult" class="result">テスト未実行</div>
            </div>

            <!-- アナリティクス機能テスト -->
            <div class="test-card">
                <h3>📊 アナリティクス</h3>
                <button onclick="testAnalytics()">アナリティクス テスト</button>
                <div id="analyticsResult" class="result">テスト未実行</div>
            </div>

            <!-- PWA機能テスト -->
            <div class="test-card">
                <h3>📱 PWA機能</h3>
                <button onclick="testPWAFeatures()">PWA テスト</button>
                <div id="pwaResult" class="result">テスト未実行</div>
            </div>

            <!-- セットアップウィザードテスト -->
            <div class="test-card">
                <h3>🎯 セットアップ</h3>
                <button onclick="testSetupWizard()">ウィザード テスト</button>
                <div id="setupResult" class="result">テスト未実行</div>
            </div>
        </div>

        <!-- 統計情報 -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="passCount">0</div>
                <div class="stat-label">成功テスト</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="failCount">0</div>
                <div class="stat-label">失敗テスト</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalTests">8</div>
                <div class="stat-label">総テスト数</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completionRate">0%</div>
                <div class="stat-label">完了率</div>
            </div>
        </div>

        <!-- 全体的なシステム状態 -->
        <div class="test-card" style="margin-top: 24px;">
            <h3>🎯 システム全体状態</h3>
            <div id="systemOverview" class="result info">
                システム状態を確認中...
            </div>
        </div>
    </div>

    <!-- JavaScript ライブラリ読み込み -->
    <script src="config.js"></script>
    <script src="ai-vision-service.js"></script>
    <script src="gemini-vision-service.js"></script>
    <script src="setup-wizard.js"></script>
    <script src="analytics-tracker.js"></script>
    <script src="backup-manager.js"></script>
    <script src="premium-features.js"></script>

    <script>
        // テスト結果の追跡
        let testResults = {
            passed: 0,
            failed: 0,
            total: 8
        };

        // 結果表示ユーティリティ
        function showResult(elementId, type, message, includeTimestamp = true) {
            const element = document.getElementById(elementId);
            const timestamp = includeTimestamp ? `[${new Date().toLocaleTimeString()}] ` : '';
            element.className = `result ${type}`;
            element.innerHTML = timestamp + message;
        }

        function updateStats() {
            document.getElementById('passCount').textContent = testResults.passed;
            document.getElementById('failCount').textContent = testResults.failed;
            const completion = Math.round(((testResults.passed + testResults.failed) / testResults.total) * 100);
            document.getElementById('completionRate').textContent = completion + '%';
        }

        function incrementResult(passed) {
            if (passed) {
                testResults.passed++;
            } else {
                testResults.failed++;
            }
            updateStats();
        }

        // 1. 基本システムテスト
        function testBasicSystem() {
            showResult('basicResult', 'loading', '基本システムをチェック中...');
            
            try {
                let results = [];
                
                // ブラウザ機能チェック
                const browserFeatures = {
                    localStorage: typeof localStorage !== 'undefined',
                    serviceWorker: 'serviceWorker' in navigator,
                    fetch: typeof fetch !== 'undefined',
                    es6: typeof Promise !== 'undefined',
                    fileReader: typeof FileReader !== 'undefined'
                };
                
                for (const [feature, supported] of Object.entries(browserFeatures)) {
                    const status = supported ? '✅' : '❌';
                    results.push(`${status} ${feature}: ${supported ? 'サポート済み' : '未サポート'}`);
                }
                
                // DOM要素チェック
                const domElements = ['HTML', 'HEAD', 'BODY'];
                domElements.forEach(tag => {
                    const exists = document.querySelector(tag.toLowerCase()) !== null;
                    const status = exists ? '✅' : '❌';
                    results.push(`${status} ${tag}要素: ${exists ? '正常' : '異常'}`);
                });
                
                // JavaScript実行環境
                results.push(`✅ JavaScript: 実行中`);
                results.push(`✅ ユーザーエージェント: ${navigator.userAgent.substring(0, 50)}...`);
                
                const allPassed = Object.values(browserFeatures).every(v => v);
                showResult('basicResult', allPassed ? 'success' : 'warning', results.join('\\n'));
                incrementResult(allPassed);
                
            } catch (error) {
                showResult('basicResult', 'error', `基本システムエラー: ${error.message}`);
                incrementResult(false);
            }
        }

        // 2. 設定・構成テスト
        function testConfiguration() {
            showResult('configResult', 'loading', '設定を確認中...');
            
            try {
                let results = [];
                
                // 設定ファイルの存在確認
                if (typeof window.FUYOU_CONFIG === 'undefined') {
                    results.push('❌ FUYOU_CONFIG未定義');
                    showResult('configResult', 'error', results.join('\\n'));
                    incrementResult(false);
                    return;
                }
                
                const config = window.FUYOU_CONFIG;
                results.push('✅ 設定ファイル読み込み成功');
                
                // 主要設定項目の確認
                const checkConfig = (path, expected) => {
                    const keys = path.split('.');
                    let value = config;
                    for (const key of keys) {
                        value = value?.[key];
                    }
                    const exists = value !== undefined;
                    const status = exists ? '✅' : '❌';
                    results.push(`${status} ${path}: ${exists ? '設定済み' : '未設定'}`);
                    return exists;
                };
                
                const configChecks = [
                    'environment',
                    'api.openai.model',
                    'api.gemini.model',
                    'fuyou.dependentLimit',
                    'pwa.enableServiceWorker',
                    'features.aiAnalysis'
                ];
                
                const configResults = configChecks.map(path => checkConfig(path));
                const configPassed = configResults.filter(r => r).length;
                
                results.push(`\\n設定完了度: ${configPassed}/${configChecks.length} (${Math.round(configPassed/configChecks.length*100)}%)`);
                
                // API キー状態
                const hasOpenAI = config.api?.openai?.apiKey && config.api.openai.apiKey !== null;
                const hasGemini = config.api?.gemini?.apiKey && config.api.gemini.apiKey !== null;
                
                results.push(`\\nAPI設定状況:`);
                results.push(`${hasOpenAI ? '✅' : '❌'} OpenAI API キー`);
                results.push(`${hasGemini ? '✅' : '❌'} Gemini API キー`);
                
                const overallPassed = configPassed >= configChecks.length * 0.8;
                showResult('configResult', overallPassed ? 'success' : 'warning', results.join('\\n'));
                incrementResult(overallPassed);
                
            } catch (error) {
                showResult('configResult', 'error', `設定エラー: ${error.message}`);
                incrementResult(false);
            }
        }

        // 3. AI機能テスト
        function testAIFeatures() {
            showResult('aiResult', 'loading', 'AI機能を確認中...');
            
            try {
                let results = [];
                
                // AIVisionService の確認
                if (typeof AIVisionService === 'undefined') {
                    results.push('❌ AIVisionService クラス未定義');
                } else {
                    results.push('✅ AIVisionService クラス定義済み');
                    
                    const aiService = new AIVisionService();
                    
                    // 初期化確認
                    if (typeof aiService.initializeGeminiService === 'function') {
                        aiService.initializeGeminiService();
                        results.push('✅ Gemini Service 初期化実行');
                    }
                    
                    // メソッドの存在確認
                    const methods = [
                        'analyzeShiftTable',
                        'convertToBase64', 
                        'isAvailable',
                        'estimateCost',
                        'analyzeWithMultipleProviders'
                    ];
                    
                    methods.forEach(method => {
                        const exists = typeof aiService[method] === 'function';
                        const status = exists ? '✅' : '❌';
                        results.push(`${status} ${method}メソッド`);
                    });
                    
                    // 利用可能性チェック
                    const isAvailable = aiService.isAvailable();
                    results.push(`${isAvailable ? '✅' : '🔶'} OpenAI API 利用可能性: ${isAvailable}`);
                }
                
                // GeminiVisionService の確認
                if (typeof GeminiVisionService !== 'undefined') {
                    results.push('✅ GeminiVisionService クラス定義済み');
                    const geminiService = new GeminiVisionService();
                    const geminiAvailable = geminiService.isAvailable();
                    results.push(`${geminiAvailable ? '✅' : '🔶'} Gemini API 利用可能性: ${geminiAvailable}`);
                } else {
                    results.push('❌ GeminiVisionService クラス未定義');
                }
                
                // テスト用画像処理（模擬）
                const testBlob = new Blob(['test'], { type: 'text/plain' });
                const testFile = new File([testBlob], 'test.txt', { type: 'text/plain' });
                
                if (typeof AIVisionService !== 'undefined') {
                    const aiService = new AIVisionService();
                    try {
                        const costEstimate = aiService.estimateCost(testFile);
                        results.push(`✅ コスト見積もり機能: $${costEstimate.estimatedCostUSD?.toFixed(4) || 'N/A'}`);
                    } catch (e) {
                        results.push(`🔶 コスト見積もり: ${e.message}`);
                    }
                }
                
                const aiPassed = results.filter(r => r.startsWith('✅')).length >= 3;
                showResult('aiResult', aiPassed ? 'success' : 'warning', results.join('\\n'));
                incrementResult(aiPassed);
                
            } catch (error) {
                showResult('aiResult', 'error', `AI機能エラー: ${error.message}`);
                incrementResult(false);
            }
        }

        // 4. プレミアム機能テスト
        function testPremiumFeatures() {
            showResult('premiumResult', 'loading', 'プレミアム機能を確認中...');
            
            try {
                let results = [];
                
                if (typeof premium === 'undefined') {
                    results.push('❌ プレミアム機能システム未定義');
                    showResult('premiumResult', 'error', results.join('\\n'));
                    incrementResult(false);
                    return;
                }
                
                results.push('✅ プレミアム機能システム初期化済み');
                
                // 現在のプレミアム状態
                const isPremium = premium.isPremium;
                const isTrialUser = premium.isTrialUser;
                results.push(`${isPremium ? '⭐' : '🔶'} プレミアム状態: ${isPremium ? 'アクティブ' : '無料版'}`);
                
                if (isTrialUser) {
                    results.push('🔥 トライアル期間中');
                }
                
                // 機能チェック
                const features = [
                    'unlimited_ai_scans',
                    'unlimited_workplaces', 
                    'advanced_analytics',
                    'smart_optimization',
                    'cloud_backup'
                ];
                
                features.forEach(feature => {
                    try {
                        const canUse = premium.canUseFeature(feature);
                        const status = canUse.allowed ? '✅' : '🔶';
                        const reason = canUse.reason || 'unknown';
                        results.push(`${status} ${feature}: ${reason}`);
                    } catch (e) {
                        results.push(`❌ ${feature}: エラー`);
                    }
                });
                
                // 使用量状況
                const allFeatures = premium.getAllFeaturesStatus();
                results.push(`\\n📊 機能状況: ${Object.keys(allFeatures.features).length}機能確認済み`);
                
                const premiumPassed = results.filter(r => r.startsWith('✅')).length >= 3;
                showResult('premiumResult', premiumPassed ? 'success' : 'warning', results.join('\\n'));
                incrementResult(premiumPassed);
                
            } catch (error) {
                showResult('premiumResult', 'error', `プレミアム機能エラー: ${error.message}`);
                incrementResult(false);
            }
        }

        // 5. バックアップ機能テスト
        function testBackupFeatures() {
            showResult('backupResult', 'loading', 'バックアップ機能を確認中...');
            
            try {
                let results = [];
                
                if (typeof backupManager === 'undefined') {
                    results.push('❌ バックアップマネージャー未定義');
                    showResult('backupResult', 'error', results.join('\\n'));
                    incrementResult(false);
                    return;
                }
                
                results.push('✅ バックアップマネージャー初期化済み');
                
                // メソッド存在確認
                const methods = [
                    'createFullBackup',
                    'exportToFile',
                    'importFromFile',
                    'getBackupList',
                    'validateBackup'
                ];
                
                methods.forEach(method => {
                    const exists = typeof backupManager[method] === 'function';
                    const status = exists ? '✅' : '❌';
                    results.push(`${status} ${method}メソッド`);
                });
                
                // 設定確認
                const autoBackupEnabled = backupManager.autoBackupEnabled;
                results.push(`${autoBackupEnabled ? '✅' : '🔶'} 自動バックアップ: ${autoBackupEnabled ? '有効' : '無効'}`);
                
                // バックアップ一覧取得テスト
                try {
                    const backupList = backupManager.getBackupList();
                    results.push(`✅ バックアップ一覧取得: ${backupList.length}件`);
                } catch (e) {
                    results.push(`🔶 バックアップ一覧: ${e.message}`);
                }
                
                // データソース確認
                const dataSources = backupManager.dataSources;
                results.push(`✅ データソース: ${dataSources.length}種類対応`);
                
                const backupPassed = results.filter(r => r.startsWith('✅')).length >= 4;
                showResult('backupResult', backupPassed ? 'success' : 'warning', results.join('\\n'));
                incrementResult(backupPassed);
                
            } catch (error) {
                showResult('backupResult', 'error', `バックアップ機能エラー: ${error.message}`);
                incrementResult(false);
            }
        }

        // 6. アナリティクス機能テスト
        function testAnalytics() {
            showResult('analyticsResult', 'loading', 'アナリティクス機能を確認中...');
            
            try {
                let results = [];
                
                if (typeof analytics === 'undefined') {
                    results.push('❌ アナリティクストラッカー未定義');
                    showResult('analyticsResult', 'error', results.join('\\n'));
                    incrementResult(false);
                    return;
                }
                
                results.push('✅ アナリティクストラッカー初期化済み');
                
                // プライバシー設定確認
                const privacyMode = analytics.privacyMode;
                const consentGiven = analytics.consentGiven;
                results.push(`✅ プライバシーモード: ${privacyMode ? '有効' : '無効'}`);
                results.push(`${consentGiven ? '✅' : '🔶'} ユーザー同意: ${consentGiven ? '取得済み' : '未取得'}`);
                
                // セッション情報
                const sessionId = analytics.sessionId;
                results.push(`✅ セッション ID: ${sessionId.substring(0, 12)}...`);
                
                // メソッド確認
                const methods = [
                    'trackEvent',
                    'trackFeatureUsage',
                    'trackError',
                    'trackPerformance',
                    'generateReport'
                ];
                
                methods.forEach(method => {
                    const exists = typeof analytics[method] === 'function';
                    const status = exists ? '✅' : '❌';
                    results.push(`${status} ${method}メソッド`);
                });
                
                // テストイベント送信
                try {
                    analytics.trackEvent('test', 'comprehensive_test', 'analytics_check');
                    results.push('✅ テストイベント送信成功');
                } catch (e) {
                    results.push(`🔶 イベント送信: ${e.message}`);
                }
                
                const analyticsPassed = results.filter(r => r.startsWith('✅')).length >= 5;
                showResult('analyticsResult', analyticsPassed ? 'success' : 'warning', results.join('\\n'));
                incrementResult(analyticsPassed);
                
            } catch (error) {
                showResult('analyticsResult', 'error', `アナリティクスエラー: ${error.message}`);
                incrementResult(false);
            }
        }

        // 7. PWA機能テスト
        function testPWAFeatures() {
            showResult('pwaResult', 'loading', 'PWA機能を確認中...');
            
            try {
                let results = [];
                
                // Service Worker 確認
                if ('serviceWorker' in navigator) {
                    results.push('✅ Service Worker サポート済み');
                    
                    navigator.serviceWorker.getRegistrations().then(registrations => {
                        const swCount = registrations.length;
                        results.push(`${swCount > 0 ? '✅' : '🔶'} Service Worker 登録: ${swCount}件`);
                    });
                } else {
                    results.push('❌ Service Worker 未サポート');
                }
                
                // マニフェスト確認
                const manifestLink = document.querySelector('link[rel="manifest"]');
                results.push(`${manifestLink ? '✅' : '❌'} PWAマニフェスト: ${manifestLink ? '設定済み' : '未設定'}`);
                
                // オフライン機能
                const isOnline = navigator.onLine;
                results.push(`${isOnline ? '✅' : '🔶'} ネットワーク状態: ${isOnline ? 'オンライン' : 'オフライン'}`);
                
                // プッシュ通知サポート
                const pushSupported = 'PushManager' in window;
                results.push(`${pushSupported ? '✅' : '❌'} プッシュ通知: ${pushSupported ? 'サポート済み' : '未サポート'}`);
                
                // localStorage 確認
                try {
                    localStorage.setItem('pwa_test', 'test');
                    localStorage.removeItem('pwa_test');
                    results.push('✅ LocalStorage: 利用可能');
                } catch (e) {
                    results.push('❌ LocalStorage: 利用不可');
                }
                
                // インストール可能性
                let installPrompt = null;
                window.addEventListener('beforeinstallprompt', (e) => {
                    installPrompt = e;
                });
                
                results.push(`${installPrompt ? '✅' : '🔶'} アプリインストール: ${installPrompt ? '可能' : '状況不明'}`);
                
                // 画面情報
                results.push(`✅ 画面サイズ: ${window.screen.width}x${window.screen.height}`);
                results.push(`✅ 表示領域: ${window.innerWidth}x${window.innerHeight}`);
                
                const pwaPassed = results.filter(r => r.startsWith('✅')).length >= 4;
                showResult('pwaResult', pwaPassed ? 'success' : 'warning', results.join('\\n'));
                incrementResult(pwaPassed);
                
            } catch (error) {
                showResult('pwaResult', 'error', `PWA機能エラー: ${error.message}`);
                incrementResult(false);
            }
        }

        // 8. セットアップウィザードテスト
        function testSetupWizard() {
            showResult('setupResult', 'loading', 'セットアップウィザードを確認中...');
            
            try {
                let results = [];
                
                if (typeof wizardInstance === 'undefined') {
                    results.push('❌ セットアップウィザード未定義');
                    showResult('setupResult', 'error', results.join('\\n'));
                    incrementResult(false);
                    return;
                }
                
                results.push('✅ セットアップウィザード初期化済み');
                
                // ウィザードの設定確認
                const steps = wizardInstance.steps;
                results.push(`✅ ウィザードステップ: ${steps ? steps.length : 0}段階`);
                
                // メソッド確認
                const methods = [
                    'start',
                    'showStep',
                    'saveSettings',
                    'checkPremiumStatus'
                ];
                
                methods.forEach(method => {
                    const exists = typeof wizardInstance[method] === 'function';
                    const status = exists ? '✅' : '❌';
                    results.push(`${status} ${method}メソッド`);
                });
                
                // セットアップ完了状況
                const setupCompleted = localStorage.getItem('fuyou_setup_completed');
                results.push(`${setupCompleted ? '✅' : '🔶'} セットアップ状況: ${setupCompleted ? '完了済み' : '未完了'}`);
                
                // ユーザー設定確認
                const userSettings = localStorage.getItem('fuyou_user_settings');
                results.push(`${userSettings ? '✅' : '🔶'} ユーザー設定: ${userSettings ? '保存済み' : '未保存'}`);
                
                const setupPassed = results.filter(r => r.startsWith('✅')).length >= 3;
                showResult('setupResult', setupPassed ? 'success' : 'warning', results.join('\\n'));
                incrementResult(setupPassed);
                
            } catch (error) {
                showResult('setupResult', 'error', `セットアップウィザードエラー: ${error.message}`);
                incrementResult(false);
            }
        }

        // 全テスト実行
        async function runAllTests() {
            // 統計リセット
            testResults = { passed: 0, failed: 0, total: 8 };
            updateStats();
            
            showResult('systemOverview', 'loading', '全体テストを実行中...');
            
            const tests = [
                testBasicSystem,
                testConfiguration,
                testAIFeatures,
                testPremiumFeatures,
                testBackupFeatures,
                testAnalytics,
                testPWAFeatures,
                testSetupWizard
            ];
            
            for (let i = 0; i < tests.length; i++) {
                await new Promise(resolve => {
                    setTimeout(() => {
                        tests[i]();
                        resolve();
                    }, 500); // 500ms 間隔で実行
                });
            }
            
            // 全体結果
            setTimeout(() => {
                const successRate = Math.round((testResults.passed / testResults.total) * 100);
                let overallStatus = 'success';
                let message = '';
                
                if (successRate >= 90) {
                    overallStatus = 'success';
                    message = `🎉 優秀！ 全機能が正常に動作しています (${successRate}%)\\n\\n✅ 成功: ${testResults.passed}/${testResults.total}\\n❌ 失敗: ${testResults.failed}/${testResults.total}\\n\\n📋 システム状態: 本番リリース準備完了`;
                } else if (successRate >= 70) {
                    overallStatus = 'warning';
                    message = `⚠️ 良好 一部改善の余地があります (${successRate}%)\\n\\n✅ 成功: ${testResults.passed}/${testResults.total}\\n❌ 失敗: ${testResults.failed}/${testResults.total}\\n\\n📋 システム状態: 軽微な修正後にリリース可能`;
                } else {
                    overallStatus = 'error';
                    message = `🚨 要修正 重要な問題があります (${successRate}%)\\n\\n✅ 成功: ${testResults.passed}/${testResults.total}\\n❌ 失敗: ${testResults.failed}/${testResults.total}\\n\\n📋 システム状態: 修正作業が必要`;
                }
                
                showResult('systemOverview', overallStatus, message);
            }, 1000);
        }

        // ページ読み込み時の初期チェック
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                showResult('systemOverview', 'info', 'システム初期化完了。「🚀 全テスト実行」ボタンで包括的なテストを開始してください。', false);
            }, 1000);
        });
    </script>
</body>
</html>